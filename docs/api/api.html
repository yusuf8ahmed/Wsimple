<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>api.api API documentation</title>
<meta name="description" content="Name: Yusuf Ahmed
Project Name: Wsimple
File Name: api/api.py
**File: Main access point to API**" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>api.api</code></h1>
</header>
<section id="section-intro">
<p>Name: Yusuf Ahmed<br>
Project Name: Wsimple <br>
File Name: api/api.py <br>
<strong>File: Main access point to API</strong></p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Name: Yusuf Ahmed  
Project Name: Wsimple   
File Name: api/api.py   
**File: Main access point to API** 
&#34;&#34;&#34;

#!/usr/bin/env python3
# standard library
import json
from loguru import logger
from typing import Optional
# custom error
from .errors import LoginError
from .errors import InvalidAccessTokenError, InvalidRefreshTokenError
from .errors import WSOTPUser, WSOTPError, WSOTPLoginError, TSXStopLimitPriceError
# third party
import requests
             
class Wsimple:
    &#34;&#34;&#34;Wsimple is the main access class to the wealthsimple trade api.&#34;&#34;&#34;
    base_url = &#34;https://trade-service.wealthsimple.com/&#34;
    time_ranges = [
        &#39;1d&#39;,
        &#39;1w&#39;,
        &#39;1m&#39;,
        &#39;3m&#39;,
        &#39;1y&#39;,
        &#39;all&#39;
    ] 
    activities_types = [
        &#39;all&#39;,
        &#39;deposit&#39;,
        &#39;withdrawal&#39;,        
        &#39;buy&#39;,
        &#39;sell&#39;,
        &#39;dividend&#39;,
        &#39;institutional_transfer&#39;,
        &#39;internal_transfer&#39;,
        &#39;refund&#39;,
        &#39;referral_bonus&#39;,
        &#39;affiliate&#39;,
    ]
    bank_logos = {
        &#34;TD Canada Trust&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/td.png&#34;,
        &#34;Royal Bank of Canada&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/rbc.png&#34;,
        &#34;Tangerine Bank&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/tangerine.png&#34;,
        &#34;CIBC&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/cibc.png&#34;,
        &#34;Bank of Montreal&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/bmo.png&#34;,
        &#34;Scotiabank&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/scotiabank.png&#34;,
        &#34;Sun Life&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/sunlife.png&#34;,
        &#34;Manulife&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/manulife.png&#34;,
        &#34;Simplii Financial&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/simplii.png&#34;,
        &#34;Great West Life&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/gwl.png&#34;,
        &#34;Investors Group&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/investors-group.png&#34;,
        &#34;Fidelity&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/fidelity.png&#34;,
        &#34;National Bank of Canada&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/nbcn.png&#34;
    }
    exchanges = {
        &#34;TSX&#34;,
        &#34;CSE&#34;,
        &#34;NYSE&#34;,
        &#34;BATS&#34;,
        &#34;FINRA&#34;,
        &#34;OTCBB&#34;,
        &#34;TSX-V&#34;,
        &#34;NASDAQ&#34;,
        &#34;OTC MARKETS&#34;,
        &#34;AEQUITAS NEO EXCHANGE&#34;
    }
    exh_to_mic = {
        &#34;TSX&#34;: &#34;XTSE&#34;,
        &#34;CSE&#34;: &#34;XCNQ&#34;,
        &#34;NYSE&#34;: &#34;XNYS&#34;,
        &#34;BATS&#34;: &#34;BATS&#34;,
        &#34;FINRA&#34;: &#34;FINR&#34;,
        &#34;OTCBB&#34;: &#34;XOTC&#34;,
        &#34;TSX-V&#34;: &#34;XTSX&#34;,
        &#34;NASDAQ&#34;: &#34;XNAS&#34;,
        &#34;OTC MARKETS&#34;: &#34;OTCM&#34;,
        &#34;AEQUITAS NEO EXCHANGE&#34;: &#34;NEOE&#34;
    }
    friendly_account_name = {
        &#39;ca_tfsa&#39;:&#39;TFSA&#39;,
        &#39;ca_non_registered&#39;: &#39;Personal account&#39;,
        &#39;ca_rrsp&#39;:&#39;RRSP account&#39;,
        &#39;ca_non_registered_crypto&#39;:&#39;Crypto account&#39;
    }
    iscanadiansecurity = lambda _, x: x in [&#34;TSX&#34;,&#34;TSX-V&#34;]
    
    def __init__(self, 
                 email, 
                 password, 
                 otp_number: int = 0,
                 otp_mode: bool = False,
                 public_mode: bool = False,     
                 oauth_mode: bool = False,              
                 verbose_mode: bool = False, 
                 tokens: Optional[list] = None):
        &#34;&#34;&#34;
        Wsimple._\_\_init_\_\_() initializes the Wsimple class and logs the user in using 
        the provided email and password. Alternatively, ***access_mode*** can be set 
        to True then and users can access the functions prefixed with public without using 
        a Wealthsimple Trade account.
        &#34;&#34;&#34;
        self.public_mode = public_mode
        self.verbose = verbose_mode
        self.oauth_mode = oauth_mode
        if self.public_mode:
            pass
        elif self.oauth_mode:
            self.tokens = tokens
        else:
            #&#34;create_account&#34;: not 1
            self.email = email
            payload = {&#34;email&#34;:email, &#34;password&#34;:password, &#34;timeoutMs&#34;: 2e4}
            if otp_mode: payload[&#34;otp&#34;] = otp_number
            r = requests.post(
                url=&#34;{}auth/login&#34;.format(self.base_url),
                data=payload
            ) 
            del payload
            logger.debug(f&#34;Login status code {r.status_code}&#34;)
            if &#34;x-wealthsimple-otp&#34; in r.headers: 
                #! one time password code login
                logger.info(&#34;One time password needed&#34;)
                try:
                    otp_headers = r.headers[&#39;x-wealthsimple-otp&#39;].replace(&#34; &#34;, &#34;&#34;).split(&#34;;&#34;)
                    method = otp_headers[1][7:] 
                    self._otp_info = {  
                                    &#34;required&#34;: (otp_headers[0]),
                                    &#34;method&#34;: otp_headers[1][7:]
                                }
                    if method == &#34;sms&#34;:
                        self._otp_info[&#34;digits&#34;] = otp_headers[2][7:]
                except:
                    raise WSOTPError
                finally:
                    raise WSOTPUser
            else:
                #! natural code login         
                if r.status_code == 200:
                    self._access_token = r.headers[&#39;X-Access-Token&#39;]
                    self._refresh_token = r.headers[&#39;X-Refresh-Token&#39;]
                    self.tokens = [
                        {&#39;Authorization&#39;: self._access_token},
                        {&#34;refresh_token&#34;: self._refresh_token}
                        ]
                    del r
                else:
                    if otp_mode: raise WSOTPLoginError
                    raise LoginError
      
    def refresh_token(self, tokens):
        &#34;&#34;&#34;
        Generates and applies a new set of access and refresh tokens.  
        &#34;&#34;&#34;
        r = requests.post(
            url=&#34;{}auth/refresh&#34;.format(self.base_url),
            data=tokens[1],
        )
        if r.status_code == 401:
            self.logger.error(&#34;dead refresh token&#34;)
            raise InvalidRefreshTokenError
        else:
            self.logger.debug(f&#34;refresh token {r.status_code} code&#34;)
            self._access_token = r.headers[&#39;X-Access-Token&#39;]
            self._refresh_token = r.headers[&#39;X-Refresh-Token&#39;]
            self.tokens = [{&#39;Authorization&#39;: self._access_token}, {&#34;refresh_token&#34;: self._refresh_token}]
            return self.tokens
  
    @classmethod
    def otp_login(cls,
                  email,
                  password,
                  otp_number,
                  verbose=False):
        &#34;&#34;&#34;
        constructor: login with a otp code:
        &#34;&#34;&#34;
        wsimple = cls(email, password, otp_mode=True, otp_number=int(otp_number))
        return wsimple 
   
    @classmethod
    def oauth_login(cls, token_dict, verbose=False):
        &#34;&#34;&#34;
        constructor: login with a predefined list of tokens:
        &#34;&#34;&#34;
        wsimple = cls(&#34;&#34;, &#34;&#34;, oauth_mode=True, tokens=token_dict, verbose_mode=verbose)
        return wsimple
                         
    @classmethod
    def public(cls, verbose=False):
        &#34;&#34;&#34;
        constructor: Use Wsimple.public functions without an wealthsimple account:
        &#34;&#34;&#34;
        wsimple = cls(&#34;&#34;, &#34;&#34;, public_mode=True, verbose_mode=verbose)
        return wsimple
 
    #! account related functions
    def get_account(self, tokens, id):
        &#34;&#34;&#34;
        Grab a specific accounts information by id 
        &#34;&#34;&#34;
        logger.debug(&#34;get_account call&#34;)
        r = requests.get(
            url=&#34;{}account/{}&#34;.format(self.base_url, id),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_account {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
    
    def get_accounts(self, tokens):
        &#34;&#34;&#34;
        Grabs all accounts information
        &#34;&#34;&#34;
        logger.debug(&#34;get_accounts call&#34;)
        r = requests.get(
            url=&#34;{}account/list&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_account {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json() 
           
    def get_trade_account_id(self, tokens):
        &#34;&#34;&#34; 
        If any function &#39;account_id&#39; param is empty, it will use 
        this function to get the first trading id  &#34;&#34;&#34;
        accounts = self.get_accounts(tokens)[&#34;results&#34;]
        for account in accounts:
            if account[&#34;account_type&#34;] == &#34;ca_non_registered&#34;:
                return account[&#34;id&#34;]

    def get_account_ids(self, tokens):
        &#34;&#34;&#34;
        Grabs all account ids under your your Wealthsimple Trade account. 
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;get_account_ids call&#34;)
            accounts = self.get_account(tokens)[&#34;results&#34;]
            account_ids = []
            for account in accounts:
                account_ids.append(account[&#34;id&#34;])
            logger.debug(f&#34;get_account_ids ^^^&#34;)
            return account_ids  
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError
        
    def get_historical_portfolio_data(self,
                                      tokens,
                                      time: str = &#34;1d&#34;,
                                      account_id: Optional[str] = None
                                      ):
        &#34;&#34;&#34;
        Grabs historical portfolio information for your Wealthsimple Trade account for a specified timeframe.  
        Where ***time*** is one of [1d, 1w, 1m, 3m, 1y, all]: autoset to 1d.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_historical_portfolio_data call&#34;)
        if account_id == None:
            account_id = self.get_trade_account_id(tokens)
        r = requests.get(
            url=&#34;{}account/history/{}&#34;.format(self.base_url, time),
            params={&#34;account_id&#34;:account_id},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_historical_portfolio_data {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_me(self, tokens):
        &#34;&#34;&#34;
        Grabs basic information about your Wealthsimple Trade account.
        &#34;&#34;&#34;
        logger.debug(&#34;get_me call&#34;)
        r = requests.get(
            url=&#34;{}me&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_me {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_person(self, tokens):
        &#34;&#34;&#34;
        Grabs Advanced/information about your Wealthsimple Trade account. 
        &#34;&#34;&#34;
        logger.debug(&#34;get_person&#34;)
        r = requests.get(
            url=&#34;{}person&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_person {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError()
        else:
            return r.json()

    def get_bank_accounts(self, tokens):
        &#34;&#34;&#34;
        Grabs all bank accounts under your Wealthsimple Trade account. 
        &#34;&#34;&#34;
        logger.debug(&#34;get_bank_accounts&#34;)
        r = requests.get(
            url=&#34;{}bank-accounts&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_bank_accounts {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError()
        else:
            return r.json()

    def get_positions(self, tokens):
        &#34;&#34;&#34;
        Grabs your current Wealthsimple Trade positions.    
        &#34;&#34;&#34;
        logger.debug(&#34;get_positions&#34;)
        r = requests.get(
            url=&#34;{}account/positions&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_positions {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError()
        else:
            return r.json()

    #! order functions
    def get_orders(self, tokens):
        &#34;&#34;&#34;
        Grabs all current and past orders.
        &#34;&#34;&#34;
        logger.debug(&#34;get_orders&#34;)
        r = requests.get(
            url=&#34;{}orders&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_orders {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def _send_order(self, tokens, payload):
        &#34;&#34;&#34; send order to wealthsimple servers &#34;&#34;&#34;
        logger.debug(&#34;create_order&#34;)
        r = requests.post(&#34;{}orders&#34;.format(self.base_url),
                    headers=tokens[0],
                    json=payload)
        logger.debug(f&#34;create_order {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
        
    def market_buy_order(self,
                         tokens,
                         security_id: str,
                         quantity: int = 1,
                         account_id: Optional[str] = None,
                         ):
        &#34;&#34;&#34;
        Places a market buy order for a security.  
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;buy_market_order&#34;)
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;limit_price&#34;: 1,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;buy_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;market&#34;,
                &#34;time_in_force&#34;: &#34;day&#34;,
                &#34;account_id&#34;: account_id
            })
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def limit_buy_order(self,
                        tokens,
                        security_id: str,
                        limit_price,
                        quantity: int = 1,
                        account_id: Optional[str] = None,
                        time_in_force: str =&#34;day&#34;):
        &#34;&#34;&#34;
        Places a limit buy order for a security.    
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;buy_limit_order&#34;)
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;account_id&#34;: account_id,
                &#34;limit_price&#34;: limit_price,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;buy_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;limit&#34;,
                &#34;time_in_force&#34;: time_in_force,
            })
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def stop_limit_buy_order(self,
                             tokens,
                             security_id: str,
                             stop_price,
                             limit_price,
                             quantity: int = 1,
                             time_in_force: str = &#34;day&#34;,
                             account_id: Optional[str] = None
                            ):
        &#34;&#34;&#34;
        Places a stop limit buy order for a security. 
        &#34;&#34;&#34;
        try:
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            security = self.find_securities_by_id(tokens, security_id)
            exchange = security[&#34;stock&#34;][&#34;primary_exchange&#34;]    
            if (self.iscanadiansecurity(exchange) and (stop_price != limit_price)):
                raise TSXStopLimitPriceError    
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;account_id&#34;: account_id,
                &#34;stop_price&#34;: stop_price,
                &#34;limit_price&#34;: limit_price,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;buy_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;stop_limit&#34;,
                &#34;time_in_force&#34;: time_in_force,
            })
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def market_sell_order(self,
                          tokens,
                          security_id: str,
                          quantity: int = 1,
                          account_id: Optional[str] = None
                          ):
        &#34;&#34;&#34;
        Places a market sell order for a security.
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;sell_market_order&#34;)
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;market_value&#34;: 1,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;sell_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;market&#34;,
                &#34;time_in_force&#34;: &#34;day&#34;,
                &#34;account_id&#34;: account_id,
            })
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def limit_sell_order(self,
                         tokens,
                         security_id: str,
                         limit_price,
                         quantity: int = 1,
                         time_in_force: str = &#34;day&#34;,
                         account_id: Optional[str] = None
                         ):
        &#34;&#34;&#34;
        Places a limit sell order for a security.  
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;sell_limit_order&#34;)
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;limit_price&#34;: limit_price,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;sell_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;limit&#34;,
                &#34;time_in_force&#34;: time_in_force,
                &#34;account_id&#34;: account_id
            })
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def stop_limit_sell_order(self,
                              tokens,
                              security_id: str,
                              stop_price,
                              limit_price,
                              quantity: int = 1,
                              time_in_force: str = &#34;day&#34;,
                              account_id: Optional[str] = None,
                              ):
        &#34;&#34;&#34;
        Places a limit sell order for a security.
        &#34;&#34;&#34;
        try:
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            security = self.find_securities_by_id(tokens, security_id)
            exchange = security[&#34;stock&#34;][&#34;primary_exchange&#34;]    
            if (self.iscanadiansecurity(exchange) and (stop_price != limit_price)):
                raise TSXStopLimitPriceError   
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;stop_price&#34;: stop_price,
                &#34;limit_price&#34;: limit_price,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;sell_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;stop_limit&#34;,
                &#34;time_in_force&#34;: time_in_force,
                &#34;account_id&#34;: account_id
            })        
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError
    
    def cancel_order(self, tokens, order_id: str):
        &#34;&#34;&#34;
        Cancels a order by its id.    
        Where ***order*** is order_id.   
        &#34;&#34;&#34;
        logger.debug(&#34;cancel_order&#34;)
        r = requests.delete(
            &#34;{}orders/{}&#34;.format(self.base_url, order_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;cancel_order {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def pending_orders(self, tokens):
        &#34;&#34;&#34;
        Grabs all pending orders under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        try:
            orders = self.get_orders(tokens)[&#39;results&#39;]
            result = []
            for order in orders:
                if order[&#39;status&#39;] == &#39;submitted&#39;:
                    result.append(order)
            return result
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError
    
    def cancelled_orders(self, tokens):
        &#34;&#34;&#34;
        Grabs all cancelled orders under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        try:
            orders = self.get_orders(tokens)[&#39;results&#39;]
            result = []
            for order in orders:
                if order[&#39;status&#39;] == &#39;cancelled&#39;:
                    result.append(order)
            return result
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def filled_orders(self, tokens):
        &#34;&#34;&#34;
        Grabs all filled orders under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        try:
            orders = self.get_orders(tokens)[&#39;results&#39;]
            result = []
            for order in orders:
                if order[&#39;status&#39;] == &#39;posted&#39;:
                    result.append(order)
            return result
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def cancel_pending_orders(self, tokens):
        &#34;&#34;&#34; cancel all pending order &#34;&#34;&#34;
        try:
            pending = self.pending_orders(tokens)
            result = []
            for orders in pending:
                result.append(self.cancel_order(tokens, orders[&#34;order_id&#34;]))
            return result
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError
        
    #! find securitites functions
    def find_securities(self, tokens, ticker: str):
        &#34;&#34;&#34;
        Grabs information about the security resembled by the ticker.    
        Where ***ticker*** is the ticker of the company, API will fuzzy    
        match this argument and therefore multiple results can appear. 
        &#34;&#34;&#34;
        logger.debug(&#34;find_securities&#34;)
        r = requests.get(
            url=&#34;{}securities&#34;.format(self.base_url),
            params={&#34;query&#34;: ticker},
            headers=tokens[0]
        )
        logger.debug(f&#34;find_securities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def find_securities_by_id(self, tokens, sec_id: str):
        &#34;&#34;&#34;
        Grabs information about the security resembled by the security id.  
        Where ***ticker*** is the ticker of the company. 
        &#34;&#34;&#34;
        logger.debug(&#34;find_securities_by_id&#34;)
        r = requests.get(
            url=&#34;{}securities/{}&#34;.format(self.base_url, sec_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;find_securities_by_id {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def find_securities_by_id_historical(self, 
                                         tokens,
                                         sec_id: str,
                                         time: str = &#34;1d&#34;,
                                         mic: str = &#34;XNAS&#34;):
        &#34;&#34;&#34;
        Grabs historical information about the security by the security id in a specified timeframe.  
        Where ***time*** is the timeframe one of [1d, 1w, 1m, 3m, 1y, all]: autoset &#34;1d&#34;.  
        Where ***mic*** is the Market Identifier Code for the exchange: autoset &#34;XNAS&#34;  
        &#34;&#34;&#34;
        logger.debug(&#34;find_securities_by_id_historical&#34;)
        r = requests.get(
            url=&#34;{}securities/{}/historical_quotes/{}&#34;.format(self.base_url, sec_id, time),
            params={&#34;mic&#34;:mic},
            headers=tokens[0]
        )
        logger.debug(f&#34;find_securities_by_id_historical {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! activities functions
    def get_activities(self, 
                       tokens, 
                       limit: int = 20,
                       type: str = &#34;all&#34;,
                       account_id: Optional[str] = None,
                       ):
        &#34;&#34;&#34;
        Grabs the 20 most recent activities on under your Wealthsimple Trade account.    
        Where ***type*** is the activities type you want can be [&#34;deposit&#34;, &#34;withdrawal&#34;, &#34;dividend&#34;, &#34;buy&#34;, &#34;sell&#34;] autoset to all.  
        Where ***limit*** is the limitation of the response has to be less than 100: autoset 20.         
        &#34;&#34;&#34;
        if account_id is None:
            account_id = self.get_trade_account_id(tokens)
        if type == &#34;all&#34;:
            logger.debug(&#34;get_activities&#34;)
            r = requests.get(
                url=&#34;{}account/activities&#34;.format(self.base_url),
                params={&#34;account-id&#34;:account_id, &#34;limit&#34;:limit},
                headers=tokens[0]
            )
        else:
            logger.debug(&#34;get_activities&#34;)
            r = requests.get(
                url=&#34;{}account/activities&#34;.format(self.base_url),
                params={&#34;account-id&#34;:account_id, &#34;type&#34;:type, &#34;limit&#34;:limit},
                headers=tokens[0]
            )  
        logger.debug(f&#34;get_activities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_activities_bookmark(self, tokens, bookmark = None):
        &#34;&#34;&#34;
        Provides the last 20 activities on the Wealthsimple Trade based on the bookmark.   
        Where ***bookmark*** is the bookmark id.   
        &#34;&#34;&#34;
        logger.debug(&#34;get_activities_bookmark&#34;)
        r = requests.get(
            url=&#34;{}account/activities&#34;.format(self.base_url),
            params={&#34;bookmark&#34;: bookmark},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_activities_bookmark {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! withdrawal functions
    def make_withdrawal(self,
                        tokens, 
                        amount: int,
                        currency: str = &#34;CAD&#34;,
                        bank_account_id: str = None,
                        account_id: Optional[str] = None):
        &#34;&#34;&#34;
        Make a withdrawal under your Wealthsimple Trade account.  
        Where ***amount*** is the amount to withdraw.  
        Where ***currency*** is the currency need to be withdrawn: autoset to &#34;CAD&#34;  
        Where ***bank_account_id*** is id of bank account where the money is going to be withdrawn from (get_bank_accounts function)  
        Where ***account_id*** is id of the account that is withdrawing the money.  
        &#34;&#34;&#34;
        logger.debug(&#34;make_withdrawal&#34;)
        if bank_account_id == None:
            bank_account_id = self.get_bank_accounts()[&#34;results&#34;][0][&#34;id&#34;]
        if account_id == None:
            account_id = self.get_trade_account_id(tokens)
        person = self.get_person()
        payload = {
            &#34;bank_account_id&#34;: str(bank_account_id),
            &#34;account_id&#34;: str(account_id),
            &#34;client_id&#34;: str(person[&#34;id&#34;]),
            &#34;withdrawal_type&#34;: &#34;full&#34;,
            &#34;withdrawal_reason&#34;: &#34;other&#34;,
            &#34;withdrawal_reason_details&#34;: &#34;other&#34;,
            &#34;amount&#34;: float(amount),
            &#34;currency&#34;: str(currency)
        }
        r = requests.post(
            url=&#39;{}withdrawals&#39;.format(self.base_url),
            headers=tokens[0],
            data=payload
        )
        logger.debug(f&#34;make_withdrawal {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_withdrawal(self, tokens, funds_transfer_id: str):
        &#34;&#34;&#34;
        Get specific withdrawal under yout Wealthsimple Trade account.
        Where ***funds_transfer_id*** is the id of the withdrawal
        &#34;&#34;&#34;
        logger.debug(&#34;get_withdrawal&#34;)
        r = requests.get(
            url=&#34;{}withdrawals/{}&#34;.format(self.base_url, funds_transfer_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_withdrawal {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def list_withdrawals(self, tokens):
        &#34;&#34;&#34;
        Get all withdrawals under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        logger.debug(&#34;list_withdrawals&#34;)
        r = requests.get(
            url=&#34;{}withdrawals&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;list_withdrawals {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def delete_withdrawal(self, tokens, funds_transfer_id: str):
        &#34;&#34;&#34;
        Delete a specific withdrawal your Wealthsimple Trade account.
        &#34;&#34;&#34;
        logger.debug(&#34;delete_withdrawal&#34;)
        r = requests.delete(
            url=&#34;{}withdrawals/{}&#34;.format(self.base_url, funds_transfer_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;delete_withdrawal {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! deposits functions
    def make_deposit(self, 
                     tokens, 
                     amount: int,
                     currency: str = &#34;CAD&#34;, 
                     bank_account_id: str = None, 
                     account_id: Optional[str] = None):
        &#34;&#34;&#34;
        Make a deposit under your Wealthsimple Trade account. 
        Where ***amount*** is the amount to deposit  
        Where ***currency*** is the currency need to be transferred: autoset to &#34;CAD&#34;  
        Where ***bank_account_id*** is id of bank account.  
        Where ***account_id*** is id of the account.  
        &#34;&#34;&#34;
        logger.debug(&#34;make_deposits&#34;)
        if bank_account_id == None:
            bank_account_id = self.get_bank_accounts()[&#34;results&#34;][0][&#34;id&#34;]
        if account_id == None:
            account_id = self.get_trade_account_id(tokens)
        person = self.get_person()
        payload = {
            &#34;client_id&#34;: str(person[&#34;id&#34;]),
            &#34;bank_account_id&#34;: str(bank_account_id),
            &#34;account_id&#34;: str(account_id),
            &#34;amount&#34;: float(amount),
            &#34;currency&#34;: str(currency)
        }
        r = requests.post(
            url=&#39;{}deposits&#39;.format(self.base_url),
            headers=tokens[0],
            data=payload
        )
        logger.debug(f&#34;make_deposits {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_deposit(self, tokens, funds_transfer_id: str):
        &#34;&#34;&#34;
        Get specific deposit under this Wealthsimple Trade account.  
        Where ***funds_transfer_id*** is the id of the deposit  
        &#34;&#34;&#34;
        logger.debug(&#34;get_deposits&#34;)
        r = requests.get(
            url=&#34;{}deposits/{}&#34;.format(self.base_url, funds_transfer_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_deposits {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def list_deposits(self, tokens):
        &#34;&#34;&#34;
        Get all deposits under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        logger.debug(&#34;list_deposits&#34;)
        r = requests.get(
            url=&#34;{}deposits&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;list_deposits {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def delete_deposit(self, tokens, funds_transfer_id: str):
        &#34;&#34;&#34;
        Delete a specific deposit under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        logger.debug(&#34;delete_deposits&#34;)
        r = requests.delete(
            url=&#34;{}deposits/{}&#34;.format(self.base_url, funds_transfer_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;delete_deposits {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! market related functions
    def get_all_markets(self, tokens):
        &#34;&#34;&#34;
        Grabs all market data including opening and closing hours 
        &#34;&#34;&#34;
        logger.debug(&#34;get_all_markets&#34;)
        r = requests.get(
            url=&#39;{}markets&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_all_markets {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_market_hours(self, tokens, exchange: str):
        &#34;&#34;&#34;
        Get all market data about a specific exchange.  
        Where ***exchange*** is the exchange name.
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;get_market_hours&#34;)
            exchanges = list(self.exh_to_mic.keys())
            if exchange in exchanges:
                all_markets = self.get_all_markets(tokens)[&#39;results&#39;]
                for market in all_markets:
                    if market[&#34;exchange_name&#34;] == exchange:
                        return market
            else:
                return {}
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    #! watchlist functions
    def get_watchlist(self, tokens):
        &#34;&#34;&#34;
        Get all watchlisted securities under your Wealthsimple trade account. 
        &#34;&#34;&#34;
        logger.debug(&#34;get_watchlist&#34;)
        r = requests.get(
            url=&#34;{}watchlist&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_watchlist {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def add_watchlist(self, tokens, sec_id: str):
        &#34;&#34;&#34;
        Add security under this Wealthsimple Trade account.    
        Where ***sec_id*** is the security id for the security you want to add.            
        &#34;&#34;&#34;
        logger.debug(&#34;add_watchlist&#34;)
        r = requests.put(
            url=&#34;{}watchlist/{}&#34;.format(self.base_url, sec_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;add_watchlist {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def delete_watchlist(self, tokens, sec_id: str):
        &#34;&#34;&#34;
        Delete a watchlisted securities in your Wealthsimple Trade account.  
        Where ***sec_id*** is the security id for the security you want to delete. 
        &#34;&#34;&#34;
        logger.debug(&#34;delete_watchlist&#34;)
        r = requests.delete(
            url=&#34;{}watchlist/{}&#34;.format(self.base_url, sec_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;delete_watchlist {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! exchange functions
    def get_exchange_rate(self, tokens):
        &#34;&#34;&#34;
        Current Wealthsimple Trade forex USD/CAD exchange rates. 
        &#34;&#34;&#34;
        logger.debug(&#34;get_exchange_rate&#34;)
        r = requests.get(
            url=&#34;{}forex&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_exchange_rate {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! fact-sheet functions
    def get_fact_sheets(self, tokens):
        &#34;&#34;&#34;
        Get all fact-sheets that you have access to under your Wealthsimple account
        &#34;&#34;&#34;
        logger.debug(&#34;get_fact_sheets&#34;)
        r = requests.get(
            url=&#39;{}fact-sheets&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_fact_sheets {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! securities groups functions
    def get_top_losers_securities(self,
                                  tokens,
                                  offset: int = 0,
                                  limit: int = 20):
        &#34;&#34;&#34;
        Grab a list of top losers securities under Wealthsimple trade today.
        Where ***offset*** is the displacement between the selected offset and the beginning.   
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_top_losers_securities&#34;)
        r = requests.get(
            url=&#39;{}securities/top_market_movers&#39;.format(self.base_url),
            params={&#34;type&#34;:&#34;losers&#34;,&#34;limit&#34;:limit,&#34;offset&#34;:offset},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_top_losers_securities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json() 

    def get_top_gainers_securities(self,
                                   tokens,
                                   offset: int = 0,
                                   limit: int = 20):
        &#34;&#34;&#34;
        Grab a list of top gainers securities under Wealthsimple trade today.
        Where ***offset*** is the displacement between the selected offset and the beginning.   
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_top_gainers_securities&#34;)
        r = requests.get(
            url=&#39;{}securities/top_market_movers&#39;.format(self.base_url),
            params={&#34;type&#34;:&#34;gainers&#34;,&#34;limit&#34;:limit,&#34;offset&#34;:offset},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_top_gainers_securities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()  
    
    def get_most_active_securities(self,
                                   tokens,
                                   limit: int = 20):
        &#34;&#34;&#34;
        Grab a list of most active securities under Wealthsimple trade today.  
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_most_active_securities&#34;)
        r = requests.get(
            url=&#39;{}securities/top_market_movers&#39;.format(self.base_url),
            params={&#34;type&#34;:&#34;most_active&#34;,&#34;limit&#34;:limit},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_most_active_securities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()      
    
    def get_most_watched_securities(self,
                                    tokens,
                                    offset: int = 0,
                                    limit: int = 20):
        &#34;&#34;&#34;
        Grabs all most watched securities under Wealthsimple trade today.
        Where ***offset*** is the displacement between the selected offset and the beginning.   
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_most_watched_securities&#34;)
        r = requests.get(
            url=&#39;{}securities/most_watched&#39;.format(self.base_url),
            params={&#34;limit&#34;:limit,&#34;offset&#34;:offset},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_most_watched_securities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()    
    
    def get_featured_security_groups(self, tokens):
        &#34;&#34;&#34;
        Grabs all featured security groups under Wealthsimple trade today
        &#34;&#34;&#34;
        logger.debug(&#34;get_featured_security_groups&#34;)
        r = requests.get(
            url=&#39;{}security-groups/featured&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_featured_security_groups {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
    
    def get_securities_in_groups(self, 
                                 tokens,
                                 group_id: str,
                                 offset: int = 0,
                                 limit: int = 20,
                                 filter_type: str = None):
        &#34;&#34;&#34;
        Grabs all securities groups under Wealthsimple trade. 
        Where ***filter_type*** - &#34;most_watched&#34; ? 
        Where ***offset*** is the displacement between the selected offset and the beginning.   
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_securities_in_groups&#34;)
        r = requests.get(
            url=&#39;{}security-groups/{}/securities&#39;.format(self.base_url, group_id),
            params={&#34;limit&#34;:limit,&#34;offset&#34;:offset,&#34;filter_type&#34;:filter_type},
            headers=tokens[0]
        )        
        logger.debug(f&#34;get_securities_in_groups {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
    
    def get_all_securities_groups(self, 
                                  tokens,
                                  offset: int = 0,
                                  limit: int = 25,
                                  order: str = &#34;desc&#34;):
        &#34;&#34;&#34;
        Grabs all security groups under Wealthsimple trade  
        Where ***offset*** is &gt;= 0: autoset to 0  
        Where ***limit*** is the limitation of the response, (1 &lt;= limit &lt; 99): autoset to 25  
        Where ***sort_order*** is order of the results and can be [&#34;asc&#34;, &#34;desc&#34;]: autoset to &#34;desc&#34;  
        &#34;&#34;&#34;
        logger.debug(&#34;get_all_securities_groups&#34;)
        r = requests.get(
            url=&#34;{}security-groups&#34;.format(self.base_url),
            params={&#34;offset&#34;:offset, &#34;limit&#34;:limit, &#34;sort_order&#34;:order},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_all_securities_groups {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            print(r.status_code)
            return r.json()
        
    #! mobile dashboard functions
    def get_mobile_dashboard(self, tokens):
        &#34;&#34;&#34;
        Get all info in the mobile dashboard
        &#34;&#34;&#34;
        logger.debug(&#34;get_mobile_dashboard&#34;)
        r = requests.get(
            url=&#39;{}mobile-dashboard&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_mobile_dashboard {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
     
    #! global alerts
    def get_alerts(self, tokens):
        &#34;&#34;&#34;
        Grab all global alerts
        &#34;&#34;&#34;
        logger.debug(&#34;get_alerts&#34;)
        result = {}
        r_user = requests.get(
            url=&#39;{}global-alerts/user&#39;.format(self.base_url),
            headers=tokens[0]
        )
        r_all = requests.get(
            url=&#39;{}global-alerts&#39;.format(self.base_url),
            headers=tokens[0]
        ) 
        result[&#34;user&#34;] = r_user.json()[&#34;results&#34;]
        result[&#34;all&#34;] = r_all.json()[&#34;results&#34;]
        logger.debug(f&#34;get_alerts user:{r_user.status_code} all:{r_all.status_code}&#34;)
        if (r_user.status_code == 401 or r_all.status_code == 401) :
            raise InvalidAccessTokenError
        else:
            return result
     
    #! internal transfers 
    def get_supported_internal_transfers(self, tokens):
        &#34;&#34;&#34;
        Grabs a list of all support interal transfers
        &#34;&#34;&#34;
        logger.debug(&#34;get_supported_internal_transfers&#34;)
        r = requests.get(
            url=&#39;{}supported-internal-transfers&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_supported_internal_transfers {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
     
    def create_internal_transfers(self, tokens, payload):
        &#34;&#34;&#34;
        create a internal transfer request  
        currently no wrapper functions.
        &#34;&#34;&#34;
        logger.debug(&#34;create_internal_transfers&#34;)
        r = requests.post(
            url=&#39;{}internal_transfers&#39;.format(self.base_url),
            headers=tokens[0],
            data=payload
        )
        logger.debug(f&#34;create_internal_transfers {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()    
    
    #! tax-documents
    def get_tax_documents(self, 
                          tokens, 
                          account_id: Optional[str] = None):
        &#34;&#34;&#34;
        Grab tax documents of your Wealthsimple account
        &#34;&#34;&#34;
        logger.debug(&#34;get_tax_documents&#34;)
        if account_id is None:
            account_id = self.get_trade_account_id(tokens)
        r = requests.get(
            url=&#39;{}tax-documents&#39;.format(self.base_url),
            param={&#34;account_id&#34;, account_id},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_tax_documents {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
     
    #! monthly-statements
    def get_monthly_statements(self, tokens):
        &#34;&#34;&#34;
        Grabs all monthly statements under your Wealthsimple account
        &#34;&#34;&#34;
        logger.debug(&#34;get_monthly_statements&#34;)
        r = requests.get(
            url=&#39;{}monthly-statements&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_monthly_statements {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
    
    def get_monthly_statements_url(self, tokens, pdf_statement_id):
        &#34;&#34;&#34;
        Grabs a url to a pdf of your statement.  
        Where ***pdf_statement_id*** is the id of the month you want to get.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_monthly_statements&#34;)
        r = requests.get(
            url=&#39;{}monthly-statements/{}&#39;.format(self.base_url, pdf_statement_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_monthly_statements {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_monthly_statements_cleaned(self, tokens):
        &#34;&#34;&#34;
        Grabs all monthly statements under your Wealthsimple account.  
        Is diffrent from ***get_monthly_statements*** as it clean the response data.   
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;get_all_monthly_statements&#34;)
            monthly_statements_data = self.get_monthly_statements(tokens)[&#34;results&#34;]
            result = []
            for data in monthly_statements_data:
                inner_dict = {}
                inner_dict[&#34;created_at&#34;] = data[&#34;created_at&#34;]
                inner_dict[&#34;updated_at&#34;] = data[&#34;updated_at&#34;]
                inner_dict[&#34;period&#34;] = data[&#34;period&#34;]
                inner_dict[&#34;id&#34;] = data[&#34;id&#34;]
                inner_dict[&#34;url&#34;] = self.get_monthly_statements_url(tokens, data[&#34;id&#34;])[&#34;url&#34;]
                result.append(inner_dict)
            logger.debug(f&#34;get_all_monthly_statements ^^^&#34;)    
            return result
                        
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    #! websocket_ticket
    def get_websocket_ticket(self, tokens):
        &#34;&#34;&#34;
        Grabs a websocket ticket, need to connect to the wealthsimple websocket 
        url for accessing websocket is:
        &#34;wss://trade-service.wealthsimple.com/websocket?ticket={}&amp;version=2&#34;.format(ticket) 
        &#34;&#34;&#34;
        logger.debug(&#34;get_websocket_ticket&#34;)
        r = requests.post(
            url=&#39;{}websocket-ticket&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_websocket_ticket {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()  

    #! functions after this point are not core to the API
    def test_endpoint(self, tokens):
        &#34;&#34;&#34;
        function for testing new endpoints
        &#34;&#34;&#34;
        logger.debug(&#34;test endpoint&#34;)
        r = requests.post(&#34;{}test&#34;.format(self.base_url),
                    headers=tokens[0]
                    )
        print(f&#34;{r.status_code} {r.url}&#34;)
        print(r.headers)
        print(r.content)
        # print(r.json())
        return r.json()

    def settings(self, tokens):
        &#34;&#34;&#34;
        Get settings data needed for settings page.
        &#34;&#34;&#34;
        logger.debug(&#34;starting settings&#34;)
        try:
            me = self.get_me(tokens)
            person = self.get_person(tokens)
            bank_account = self.get_bank_accounts(tokens)
            exchange_rate = self.get_exchange_rate(tokens)
            ws_current_operational_status = self.current_status()
            return {
                &#39;me&#39;: me,
                &#39;person&#39;: person,
                &#39;bank_account&#39;: bank_account,
                &#39;exchange_rate&#39;: exchange_rate,
                &#39;ws_current_operational_status&#39;: ws_current_operational_status
            }
        except InvalidAccessTokenError:
            logger.debug(&#34;settings InvalidAccessTokenError&#34;)
            raise InvalidAccessTokenError

    def stock(self,
              tokens,
              sec_id: str,
              time: str = &#34;1d&#34;):
        &#34;&#34;&#34;
        Get security data needed for stock search pages.
        &#34;&#34;&#34;
        logger.debug(&#34;starting stock {}&#34;.format(sec_id))
        try:
            sparkline = self.find_securities_by_id_historical(tokens, sec_id, time)
            security_info = self.find_securities_by_id(tokens, sec_id)
            news = self.public_find_securities_news(security_info[&#34;stock&#34;][&#34;symbol&#34;])
            position = self.get_account(tokens)
            return {
                &#34;sparkline&#34;: sparkline,
                &#34;security_info&#34;: security_info,
                &#34;position&#34;: position,
                &#34;news&#34;: news 
            }
        except InvalidAccessTokenError:
            logger.error(&#34;stock InvalidAccessTokenError&#34;)
            raise InvalidAccessTokenError
        
    def search_page(self, tokens):
        &#34;&#34;&#34;
        Get groups need for search page
        &#34;&#34;&#34;
        try:
            featured_security_groups = self.get_featured_security_groups(tokens)
            get_top_losers_securities = self.get_top_losers_securities(tokens, limit=5)
            get_top_gainers_securities = self.get_top_gainers_securities(tokens, limit=5)
            get_most_active_securities = self.get_most_active_securities(tokens, limit=5)
            get_most_watched_securities = self.get_most_watched_securities(tokens, limit=5)
            return {
                &#34;featured_security_groups&#34;: featured_security_groups,
                &#34;most_watched&#34;: get_most_watched_securities,
                &#34;most_active&#34;: get_most_active_securities,
                &#34;top_gainers&#34;: get_top_gainers_securities,
                &#34;top_losers&#34;: get_top_losers_securities,
            }
        except InvalidAccessTokenError:
            logger.error(&#34;search_page InvalidAccessTokenError&#34;)
            raise InvalidAccessTokenError

    def dashboard(self, tokens):
        &#34;&#34;&#34;
        Get dashboard page needed for home page.    
        &#34;&#34;&#34;
        logger.debug(&#34;calling dashboard&#34;)
        try:
            mobile_dashboard = self.get_mobile_dashboard(tokens)
            account_data = self.get_historical_portfolio_data(tokens)
            
            account = mobile_dashboard[&#34;accounts&#34;][0]
            watchlist = mobile_dashboard[&#34;watchlist&#34;]
            positions = mobile_dashboard[&#34;positions&#34;]
            previous_amount = account_data[&#34;previous_close_net_liquidation_value&#34;][&#39;amount&#39;]
            total_value = account_data[&#34;results&#34;][-1][&#34;value&#34;]
            account_value_graph = account_data[&#34;results&#34;]
            account_change = round(total_value[&#39;amount&#39;] - previous_amount, 2)
            account_change_percentage = round((account_change / previous_amount)*100, 2)
            return {
                &#39;available_to_trade&#39;: {
                    &#39;amount&#39;: account[&#39;buying_power&#39;][&#39;amount&#39;],
                    &#39;currency&#39;: account[&#39;buying_power&#39;][&#39;currency&#39;]
                },
                &#39;account_value&#39;: {
                    &#39;amount&#39;: total_value[&#39;amount&#39;],
                    &#39;currency&#39;: total_value[&#39;currency&#39;]
                },
                &#39;net_deposits&#39;: {
                    &#39;amount&#39;: account[&#39;net_deposits&#39;][&#39;amount&#39;],
                    &#39;currency&#39;: account[&#39;net_deposits&#39;][&#39;currency&#39;]
                },
                &#39;available_to_withdraw&#39;: {
                    &#39;amount&#39;: account[&#39;available_to_withdraw&#39;][&#39;amount&#39;],
                    &#39;currency&#39;: account[&#39;available_to_withdraw&#39;][&#39;currency&#39;]
                },
                &#39;account_change&#39;: {
                    &#39;amount&#39;: account_change,
                    &#39;percentage&#39;: account_change_percentage
                },
                &#39;account_value_graph&#39;: {
                    &#39;table&#39;: account_value_graph
                },
                &#39;account_positions&#39;: {
                    &#39;table&#39;: positions
                },
                &#39;account_watchlist&#39;: {
                    &#39;table&#39;: watchlist
                }
            }
        except InvalidAccessTokenError:
            logger.error(&#34;dashboard InvalidAccessTokenError&#34;)
            raise InvalidAccessTokenError

    #! public prefix functions
    @staticmethod
    def public_find_securities_by_ticker(ticker):
        &#34;&#34;&#34;
        Grabs information about the security resembled by the ticker.  
        Where ***ticker*** is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.
        !May not work on smaller companies or ETFs. 
        &#34;&#34;&#34;
        base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
        r = requests.get(
            url=&#34;{}securities/{}&#34;.format(base_url_public, ticker)
        )
        return r.json()

    @staticmethod
    def public_find_securities_by_ticker_historical(ticker, time):
        &#34;&#34;&#34;
        Get a company historical data based on a time.    
        Where ***ticker*** is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.  
        Where ***time*** is (&#34;1d&#34;, &#34;1w&#34;, &#34;1m&#34;, &#34;3m&#34;, &#34;1y&#34;): DOES NOT INCLUDE (&#34;all&#34;).   
        !May not work on smaller companies or ETFs.  
        &#34;&#34;&#34;
        base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
        r = requests.get(
            url=&#34;{}securities/{}/historical_quotes/{}&#34;.format(
                base_url_public, ticker, time)
        )
        return r.json()

    @staticmethod
    def public_top_traded(offset: int = 0, limit: int = 5):
        &#34;&#34;&#34;
        Get top traded companies on Wealthsimple trade.  
        Where ***offset*** is the displacement between the selected offset and the beginning.   
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
        r = requests.get(
            url=&#34;{}securities/top_traded&#34;.format(base_url_public),
            params={&#34;offset&#34;: offset,&#34;limit&#34;:limit}
        )
        return r.json()

    @staticmethod
    def public_find_securities_news(ticker):
        &#34;&#34;&#34;
        Get public news based on the ticker.    
        Where ***ticker*** is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.   
        !May not work on smaller companies or ETF. 
        &#34;&#34;&#34;
        base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
        r = requests.get(
            url=&#34;{}securities/{}/news&#34;.format(base_url_public, ticker)
        )
        return r.json()

    #! public prefix functions: wealthsimple operational status
    @staticmethod
    def summary_status():
        &#34;&#34;&#34;
        Get current summary status/incidents of Wealthsimple trade.     
        This function returns data on these systems:  
        Login and Account Access, Deposits and Withdrawals,   
        Security Search, Order execution, Order submission,   
        Order Cancellation, Linking bank accounts,   
        Quotes, Order status, Trading, Market Data,  
        Account Values, Account Opening,   
        Apps, iOS app, Android App  
        the data is in the body(content), data is large.  
        &#34;&#34;&#34;
        r = requests.get(
            url=&#34;https://status.wealthsimple.com/api/v2/summary.json&#34;
        )
        return json.loads(r.content)

    @staticmethod
    def current_status():
        &#34;&#34;&#34;
        Get current status/incidents of wealthsimple trade.    
        the data is in body(content), data could be large. 
        &#34;&#34;&#34;
        r = requests.get(
            url=&#34;https://status.wealthsimple.com/api/v2/status.json&#34;
        )
        return json.loads(r.content)

    @staticmethod
    def historical_status():
        &#34;&#34;&#34;
        Get all previous history status/incidents of wealthsimple trade.   
        the data is in body(content), data could be large. 
        &#34;&#34;&#34;
        r = requests.get(
            url=&#34;https://status.wealthsimple.com/api/v2/incidents.json&#34;
        )
        return json.loads(r.content)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="api.api.Wsimple"><code class="flex name class">
<span>class <span class="ident">Wsimple</span></span>
<span>(</span><span>email, password, otp_number:int=0, otp_mode:bool=False, public_mode:bool=False, oauth_mode:bool=False, verbose_mode:bool=False, tokens:Optional[list]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Wsimple is the main access class to the wealthsimple trade api.</p>
<p>Wsimple.<em>__init</em>__() initializes the Wsimple class and logs the user in using
the provided email and password. Alternatively, <strong><em>access_mode</em></strong> can be set
to True then and users can access the functions prefixed with public without using
a Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Wsimple:
    &#34;&#34;&#34;Wsimple is the main access class to the wealthsimple trade api.&#34;&#34;&#34;
    base_url = &#34;https://trade-service.wealthsimple.com/&#34;
    time_ranges = [
        &#39;1d&#39;,
        &#39;1w&#39;,
        &#39;1m&#39;,
        &#39;3m&#39;,
        &#39;1y&#39;,
        &#39;all&#39;
    ] 
    activities_types = [
        &#39;all&#39;,
        &#39;deposit&#39;,
        &#39;withdrawal&#39;,        
        &#39;buy&#39;,
        &#39;sell&#39;,
        &#39;dividend&#39;,
        &#39;institutional_transfer&#39;,
        &#39;internal_transfer&#39;,
        &#39;refund&#39;,
        &#39;referral_bonus&#39;,
        &#39;affiliate&#39;,
    ]
    bank_logos = {
        &#34;TD Canada Trust&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/td.png&#34;,
        &#34;Royal Bank of Canada&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/rbc.png&#34;,
        &#34;Tangerine Bank&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/tangerine.png&#34;,
        &#34;CIBC&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/cibc.png&#34;,
        &#34;Bank of Montreal&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/bmo.png&#34;,
        &#34;Scotiabank&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/scotiabank.png&#34;,
        &#34;Sun Life&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/sunlife.png&#34;,
        &#34;Manulife&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/manulife.png&#34;,
        &#34;Simplii Financial&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/simplii.png&#34;,
        &#34;Great West Life&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/gwl.png&#34;,
        &#34;Investors Group&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/investors-group.png&#34;,
        &#34;Fidelity&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/fidelity.png&#34;,
        &#34;National Bank of Canada&#34;: &#34;https://s3.amazonaws.com/bank-verification-ui/institution-logos/nbcn.png&#34;
    }
    exchanges = {
        &#34;TSX&#34;,
        &#34;CSE&#34;,
        &#34;NYSE&#34;,
        &#34;BATS&#34;,
        &#34;FINRA&#34;,
        &#34;OTCBB&#34;,
        &#34;TSX-V&#34;,
        &#34;NASDAQ&#34;,
        &#34;OTC MARKETS&#34;,
        &#34;AEQUITAS NEO EXCHANGE&#34;
    }
    exh_to_mic = {
        &#34;TSX&#34;: &#34;XTSE&#34;,
        &#34;CSE&#34;: &#34;XCNQ&#34;,
        &#34;NYSE&#34;: &#34;XNYS&#34;,
        &#34;BATS&#34;: &#34;BATS&#34;,
        &#34;FINRA&#34;: &#34;FINR&#34;,
        &#34;OTCBB&#34;: &#34;XOTC&#34;,
        &#34;TSX-V&#34;: &#34;XTSX&#34;,
        &#34;NASDAQ&#34;: &#34;XNAS&#34;,
        &#34;OTC MARKETS&#34;: &#34;OTCM&#34;,
        &#34;AEQUITAS NEO EXCHANGE&#34;: &#34;NEOE&#34;
    }
    friendly_account_name = {
        &#39;ca_tfsa&#39;:&#39;TFSA&#39;,
        &#39;ca_non_registered&#39;: &#39;Personal account&#39;,
        &#39;ca_rrsp&#39;:&#39;RRSP account&#39;,
        &#39;ca_non_registered_crypto&#39;:&#39;Crypto account&#39;
    }
    iscanadiansecurity = lambda _, x: x in [&#34;TSX&#34;,&#34;TSX-V&#34;]
    
    def __init__(self, 
                 email, 
                 password, 
                 otp_number: int = 0,
                 otp_mode: bool = False,
                 public_mode: bool = False,     
                 oauth_mode: bool = False,              
                 verbose_mode: bool = False, 
                 tokens: Optional[list] = None):
        &#34;&#34;&#34;
        Wsimple._\_\_init_\_\_() initializes the Wsimple class and logs the user in using 
        the provided email and password. Alternatively, ***access_mode*** can be set 
        to True then and users can access the functions prefixed with public without using 
        a Wealthsimple Trade account.
        &#34;&#34;&#34;
        self.public_mode = public_mode
        self.verbose = verbose_mode
        self.oauth_mode = oauth_mode
        if self.public_mode:
            pass
        elif self.oauth_mode:
            self.tokens = tokens
        else:
            #&#34;create_account&#34;: not 1
            self.email = email
            payload = {&#34;email&#34;:email, &#34;password&#34;:password, &#34;timeoutMs&#34;: 2e4}
            if otp_mode: payload[&#34;otp&#34;] = otp_number
            r = requests.post(
                url=&#34;{}auth/login&#34;.format(self.base_url),
                data=payload
            ) 
            del payload
            logger.debug(f&#34;Login status code {r.status_code}&#34;)
            if &#34;x-wealthsimple-otp&#34; in r.headers: 
                #! one time password code login
                logger.info(&#34;One time password needed&#34;)
                try:
                    otp_headers = r.headers[&#39;x-wealthsimple-otp&#39;].replace(&#34; &#34;, &#34;&#34;).split(&#34;;&#34;)
                    method = otp_headers[1][7:] 
                    self._otp_info = {  
                                    &#34;required&#34;: (otp_headers[0]),
                                    &#34;method&#34;: otp_headers[1][7:]
                                }
                    if method == &#34;sms&#34;:
                        self._otp_info[&#34;digits&#34;] = otp_headers[2][7:]
                except:
                    raise WSOTPError
                finally:
                    raise WSOTPUser
            else:
                #! natural code login         
                if r.status_code == 200:
                    self._access_token = r.headers[&#39;X-Access-Token&#39;]
                    self._refresh_token = r.headers[&#39;X-Refresh-Token&#39;]
                    self.tokens = [
                        {&#39;Authorization&#39;: self._access_token},
                        {&#34;refresh_token&#34;: self._refresh_token}
                        ]
                    del r
                else:
                    if otp_mode: raise WSOTPLoginError
                    raise LoginError
      
    def refresh_token(self, tokens):
        &#34;&#34;&#34;
        Generates and applies a new set of access and refresh tokens.  
        &#34;&#34;&#34;
        r = requests.post(
            url=&#34;{}auth/refresh&#34;.format(self.base_url),
            data=tokens[1],
        )
        if r.status_code == 401:
            self.logger.error(&#34;dead refresh token&#34;)
            raise InvalidRefreshTokenError
        else:
            self.logger.debug(f&#34;refresh token {r.status_code} code&#34;)
            self._access_token = r.headers[&#39;X-Access-Token&#39;]
            self._refresh_token = r.headers[&#39;X-Refresh-Token&#39;]
            self.tokens = [{&#39;Authorization&#39;: self._access_token}, {&#34;refresh_token&#34;: self._refresh_token}]
            return self.tokens
  
    @classmethod
    def otp_login(cls,
                  email,
                  password,
                  otp_number,
                  verbose=False):
        &#34;&#34;&#34;
        constructor: login with a otp code:
        &#34;&#34;&#34;
        wsimple = cls(email, password, otp_mode=True, otp_number=int(otp_number))
        return wsimple 
   
    @classmethod
    def oauth_login(cls, token_dict, verbose=False):
        &#34;&#34;&#34;
        constructor: login with a predefined list of tokens:
        &#34;&#34;&#34;
        wsimple = cls(&#34;&#34;, &#34;&#34;, oauth_mode=True, tokens=token_dict, verbose_mode=verbose)
        return wsimple
                         
    @classmethod
    def public(cls, verbose=False):
        &#34;&#34;&#34;
        constructor: Use Wsimple.public functions without an wealthsimple account:
        &#34;&#34;&#34;
        wsimple = cls(&#34;&#34;, &#34;&#34;, public_mode=True, verbose_mode=verbose)
        return wsimple
 
    #! account related functions
    def get_account(self, tokens, id):
        &#34;&#34;&#34;
        Grab a specific accounts information by id 
        &#34;&#34;&#34;
        logger.debug(&#34;get_account call&#34;)
        r = requests.get(
            url=&#34;{}account/{}&#34;.format(self.base_url, id),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_account {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
    
    def get_accounts(self, tokens):
        &#34;&#34;&#34;
        Grabs all accounts information
        &#34;&#34;&#34;
        logger.debug(&#34;get_accounts call&#34;)
        r = requests.get(
            url=&#34;{}account/list&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_account {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json() 
           
    def get_trade_account_id(self, tokens):
        &#34;&#34;&#34; 
        If any function &#39;account_id&#39; param is empty, it will use 
        this function to get the first trading id  &#34;&#34;&#34;
        accounts = self.get_accounts(tokens)[&#34;results&#34;]
        for account in accounts:
            if account[&#34;account_type&#34;] == &#34;ca_non_registered&#34;:
                return account[&#34;id&#34;]

    def get_account_ids(self, tokens):
        &#34;&#34;&#34;
        Grabs all account ids under your your Wealthsimple Trade account. 
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;get_account_ids call&#34;)
            accounts = self.get_account(tokens)[&#34;results&#34;]
            account_ids = []
            for account in accounts:
                account_ids.append(account[&#34;id&#34;])
            logger.debug(f&#34;get_account_ids ^^^&#34;)
            return account_ids  
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError
        
    def get_historical_portfolio_data(self,
                                      tokens,
                                      time: str = &#34;1d&#34;,
                                      account_id: Optional[str] = None
                                      ):
        &#34;&#34;&#34;
        Grabs historical portfolio information for your Wealthsimple Trade account for a specified timeframe.  
        Where ***time*** is one of [1d, 1w, 1m, 3m, 1y, all]: autoset to 1d.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_historical_portfolio_data call&#34;)
        if account_id == None:
            account_id = self.get_trade_account_id(tokens)
        r = requests.get(
            url=&#34;{}account/history/{}&#34;.format(self.base_url, time),
            params={&#34;account_id&#34;:account_id},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_historical_portfolio_data {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_me(self, tokens):
        &#34;&#34;&#34;
        Grabs basic information about your Wealthsimple Trade account.
        &#34;&#34;&#34;
        logger.debug(&#34;get_me call&#34;)
        r = requests.get(
            url=&#34;{}me&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_me {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_person(self, tokens):
        &#34;&#34;&#34;
        Grabs Advanced/information about your Wealthsimple Trade account. 
        &#34;&#34;&#34;
        logger.debug(&#34;get_person&#34;)
        r = requests.get(
            url=&#34;{}person&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_person {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError()
        else:
            return r.json()

    def get_bank_accounts(self, tokens):
        &#34;&#34;&#34;
        Grabs all bank accounts under your Wealthsimple Trade account. 
        &#34;&#34;&#34;
        logger.debug(&#34;get_bank_accounts&#34;)
        r = requests.get(
            url=&#34;{}bank-accounts&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_bank_accounts {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError()
        else:
            return r.json()

    def get_positions(self, tokens):
        &#34;&#34;&#34;
        Grabs your current Wealthsimple Trade positions.    
        &#34;&#34;&#34;
        logger.debug(&#34;get_positions&#34;)
        r = requests.get(
            url=&#34;{}account/positions&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_positions {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError()
        else:
            return r.json()

    #! order functions
    def get_orders(self, tokens):
        &#34;&#34;&#34;
        Grabs all current and past orders.
        &#34;&#34;&#34;
        logger.debug(&#34;get_orders&#34;)
        r = requests.get(
            url=&#34;{}orders&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_orders {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def _send_order(self, tokens, payload):
        &#34;&#34;&#34; send order to wealthsimple servers &#34;&#34;&#34;
        logger.debug(&#34;create_order&#34;)
        r = requests.post(&#34;{}orders&#34;.format(self.base_url),
                    headers=tokens[0],
                    json=payload)
        logger.debug(f&#34;create_order {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
        
    def market_buy_order(self,
                         tokens,
                         security_id: str,
                         quantity: int = 1,
                         account_id: Optional[str] = None,
                         ):
        &#34;&#34;&#34;
        Places a market buy order for a security.  
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;buy_market_order&#34;)
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;limit_price&#34;: 1,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;buy_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;market&#34;,
                &#34;time_in_force&#34;: &#34;day&#34;,
                &#34;account_id&#34;: account_id
            })
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def limit_buy_order(self,
                        tokens,
                        security_id: str,
                        limit_price,
                        quantity: int = 1,
                        account_id: Optional[str] = None,
                        time_in_force: str =&#34;day&#34;):
        &#34;&#34;&#34;
        Places a limit buy order for a security.    
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;buy_limit_order&#34;)
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;account_id&#34;: account_id,
                &#34;limit_price&#34;: limit_price,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;buy_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;limit&#34;,
                &#34;time_in_force&#34;: time_in_force,
            })
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def stop_limit_buy_order(self,
                             tokens,
                             security_id: str,
                             stop_price,
                             limit_price,
                             quantity: int = 1,
                             time_in_force: str = &#34;day&#34;,
                             account_id: Optional[str] = None
                            ):
        &#34;&#34;&#34;
        Places a stop limit buy order for a security. 
        &#34;&#34;&#34;
        try:
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            security = self.find_securities_by_id(tokens, security_id)
            exchange = security[&#34;stock&#34;][&#34;primary_exchange&#34;]    
            if (self.iscanadiansecurity(exchange) and (stop_price != limit_price)):
                raise TSXStopLimitPriceError    
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;account_id&#34;: account_id,
                &#34;stop_price&#34;: stop_price,
                &#34;limit_price&#34;: limit_price,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;buy_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;stop_limit&#34;,
                &#34;time_in_force&#34;: time_in_force,
            })
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def market_sell_order(self,
                          tokens,
                          security_id: str,
                          quantity: int = 1,
                          account_id: Optional[str] = None
                          ):
        &#34;&#34;&#34;
        Places a market sell order for a security.
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;sell_market_order&#34;)
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;market_value&#34;: 1,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;sell_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;market&#34;,
                &#34;time_in_force&#34;: &#34;day&#34;,
                &#34;account_id&#34;: account_id,
            })
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def limit_sell_order(self,
                         tokens,
                         security_id: str,
                         limit_price,
                         quantity: int = 1,
                         time_in_force: str = &#34;day&#34;,
                         account_id: Optional[str] = None
                         ):
        &#34;&#34;&#34;
        Places a limit sell order for a security.  
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;sell_limit_order&#34;)
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;limit_price&#34;: limit_price,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;sell_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;limit&#34;,
                &#34;time_in_force&#34;: time_in_force,
                &#34;account_id&#34;: account_id
            })
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def stop_limit_sell_order(self,
                              tokens,
                              security_id: str,
                              stop_price,
                              limit_price,
                              quantity: int = 1,
                              time_in_force: str = &#34;day&#34;,
                              account_id: Optional[str] = None,
                              ):
        &#34;&#34;&#34;
        Places a limit sell order for a security.
        &#34;&#34;&#34;
        try:
            if account_id is None:
                account_id = self.get_trade_account_id(tokens)
            security = self.find_securities_by_id(tokens, security_id)
            exchange = security[&#34;stock&#34;][&#34;primary_exchange&#34;]    
            if (self.iscanadiansecurity(exchange) and (stop_price != limit_price)):
                raise TSXStopLimitPriceError   
            return self._send_order(tokens, {
                &#34;security_id&#34;: security_id,
                &#34;stop_price&#34;: stop_price,
                &#34;limit_price&#34;: limit_price,
                &#34;quantity&#34;: quantity,
                &#34;order_type&#34;: &#34;sell_quantity&#34;,
                &#34;order_sub_type&#34;: &#34;stop_limit&#34;,
                &#34;time_in_force&#34;: time_in_force,
                &#34;account_id&#34;: account_id
            })        
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError
    
    def cancel_order(self, tokens, order_id: str):
        &#34;&#34;&#34;
        Cancels a order by its id.    
        Where ***order*** is order_id.   
        &#34;&#34;&#34;
        logger.debug(&#34;cancel_order&#34;)
        r = requests.delete(
            &#34;{}orders/{}&#34;.format(self.base_url, order_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;cancel_order {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def pending_orders(self, tokens):
        &#34;&#34;&#34;
        Grabs all pending orders under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        try:
            orders = self.get_orders(tokens)[&#39;results&#39;]
            result = []
            for order in orders:
                if order[&#39;status&#39;] == &#39;submitted&#39;:
                    result.append(order)
            return result
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError
    
    def cancelled_orders(self, tokens):
        &#34;&#34;&#34;
        Grabs all cancelled orders under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        try:
            orders = self.get_orders(tokens)[&#39;results&#39;]
            result = []
            for order in orders:
                if order[&#39;status&#39;] == &#39;cancelled&#39;:
                    result.append(order)
            return result
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def filled_orders(self, tokens):
        &#34;&#34;&#34;
        Grabs all filled orders under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        try:
            orders = self.get_orders(tokens)[&#39;results&#39;]
            result = []
            for order in orders:
                if order[&#39;status&#39;] == &#39;posted&#39;:
                    result.append(order)
            return result
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    def cancel_pending_orders(self, tokens):
        &#34;&#34;&#34; cancel all pending order &#34;&#34;&#34;
        try:
            pending = self.pending_orders(tokens)
            result = []
            for orders in pending:
                result.append(self.cancel_order(tokens, orders[&#34;order_id&#34;]))
            return result
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError
        
    #! find securitites functions
    def find_securities(self, tokens, ticker: str):
        &#34;&#34;&#34;
        Grabs information about the security resembled by the ticker.    
        Where ***ticker*** is the ticker of the company, API will fuzzy    
        match this argument and therefore multiple results can appear. 
        &#34;&#34;&#34;
        logger.debug(&#34;find_securities&#34;)
        r = requests.get(
            url=&#34;{}securities&#34;.format(self.base_url),
            params={&#34;query&#34;: ticker},
            headers=tokens[0]
        )
        logger.debug(f&#34;find_securities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def find_securities_by_id(self, tokens, sec_id: str):
        &#34;&#34;&#34;
        Grabs information about the security resembled by the security id.  
        Where ***ticker*** is the ticker of the company. 
        &#34;&#34;&#34;
        logger.debug(&#34;find_securities_by_id&#34;)
        r = requests.get(
            url=&#34;{}securities/{}&#34;.format(self.base_url, sec_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;find_securities_by_id {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def find_securities_by_id_historical(self, 
                                         tokens,
                                         sec_id: str,
                                         time: str = &#34;1d&#34;,
                                         mic: str = &#34;XNAS&#34;):
        &#34;&#34;&#34;
        Grabs historical information about the security by the security id in a specified timeframe.  
        Where ***time*** is the timeframe one of [1d, 1w, 1m, 3m, 1y, all]: autoset &#34;1d&#34;.  
        Where ***mic*** is the Market Identifier Code for the exchange: autoset &#34;XNAS&#34;  
        &#34;&#34;&#34;
        logger.debug(&#34;find_securities_by_id_historical&#34;)
        r = requests.get(
            url=&#34;{}securities/{}/historical_quotes/{}&#34;.format(self.base_url, sec_id, time),
            params={&#34;mic&#34;:mic},
            headers=tokens[0]
        )
        logger.debug(f&#34;find_securities_by_id_historical {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! activities functions
    def get_activities(self, 
                       tokens, 
                       limit: int = 20,
                       type: str = &#34;all&#34;,
                       account_id: Optional[str] = None,
                       ):
        &#34;&#34;&#34;
        Grabs the 20 most recent activities on under your Wealthsimple Trade account.    
        Where ***type*** is the activities type you want can be [&#34;deposit&#34;, &#34;withdrawal&#34;, &#34;dividend&#34;, &#34;buy&#34;, &#34;sell&#34;] autoset to all.  
        Where ***limit*** is the limitation of the response has to be less than 100: autoset 20.         
        &#34;&#34;&#34;
        if account_id is None:
            account_id = self.get_trade_account_id(tokens)
        if type == &#34;all&#34;:
            logger.debug(&#34;get_activities&#34;)
            r = requests.get(
                url=&#34;{}account/activities&#34;.format(self.base_url),
                params={&#34;account-id&#34;:account_id, &#34;limit&#34;:limit},
                headers=tokens[0]
            )
        else:
            logger.debug(&#34;get_activities&#34;)
            r = requests.get(
                url=&#34;{}account/activities&#34;.format(self.base_url),
                params={&#34;account-id&#34;:account_id, &#34;type&#34;:type, &#34;limit&#34;:limit},
                headers=tokens[0]
            )  
        logger.debug(f&#34;get_activities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_activities_bookmark(self, tokens, bookmark = None):
        &#34;&#34;&#34;
        Provides the last 20 activities on the Wealthsimple Trade based on the bookmark.   
        Where ***bookmark*** is the bookmark id.   
        &#34;&#34;&#34;
        logger.debug(&#34;get_activities_bookmark&#34;)
        r = requests.get(
            url=&#34;{}account/activities&#34;.format(self.base_url),
            params={&#34;bookmark&#34;: bookmark},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_activities_bookmark {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! withdrawal functions
    def make_withdrawal(self,
                        tokens, 
                        amount: int,
                        currency: str = &#34;CAD&#34;,
                        bank_account_id: str = None,
                        account_id: Optional[str] = None):
        &#34;&#34;&#34;
        Make a withdrawal under your Wealthsimple Trade account.  
        Where ***amount*** is the amount to withdraw.  
        Where ***currency*** is the currency need to be withdrawn: autoset to &#34;CAD&#34;  
        Where ***bank_account_id*** is id of bank account where the money is going to be withdrawn from (get_bank_accounts function)  
        Where ***account_id*** is id of the account that is withdrawing the money.  
        &#34;&#34;&#34;
        logger.debug(&#34;make_withdrawal&#34;)
        if bank_account_id == None:
            bank_account_id = self.get_bank_accounts()[&#34;results&#34;][0][&#34;id&#34;]
        if account_id == None:
            account_id = self.get_trade_account_id(tokens)
        person = self.get_person()
        payload = {
            &#34;bank_account_id&#34;: str(bank_account_id),
            &#34;account_id&#34;: str(account_id),
            &#34;client_id&#34;: str(person[&#34;id&#34;]),
            &#34;withdrawal_type&#34;: &#34;full&#34;,
            &#34;withdrawal_reason&#34;: &#34;other&#34;,
            &#34;withdrawal_reason_details&#34;: &#34;other&#34;,
            &#34;amount&#34;: float(amount),
            &#34;currency&#34;: str(currency)
        }
        r = requests.post(
            url=&#39;{}withdrawals&#39;.format(self.base_url),
            headers=tokens[0],
            data=payload
        )
        logger.debug(f&#34;make_withdrawal {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_withdrawal(self, tokens, funds_transfer_id: str):
        &#34;&#34;&#34;
        Get specific withdrawal under yout Wealthsimple Trade account.
        Where ***funds_transfer_id*** is the id of the withdrawal
        &#34;&#34;&#34;
        logger.debug(&#34;get_withdrawal&#34;)
        r = requests.get(
            url=&#34;{}withdrawals/{}&#34;.format(self.base_url, funds_transfer_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_withdrawal {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def list_withdrawals(self, tokens):
        &#34;&#34;&#34;
        Get all withdrawals under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        logger.debug(&#34;list_withdrawals&#34;)
        r = requests.get(
            url=&#34;{}withdrawals&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;list_withdrawals {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def delete_withdrawal(self, tokens, funds_transfer_id: str):
        &#34;&#34;&#34;
        Delete a specific withdrawal your Wealthsimple Trade account.
        &#34;&#34;&#34;
        logger.debug(&#34;delete_withdrawal&#34;)
        r = requests.delete(
            url=&#34;{}withdrawals/{}&#34;.format(self.base_url, funds_transfer_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;delete_withdrawal {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! deposits functions
    def make_deposit(self, 
                     tokens, 
                     amount: int,
                     currency: str = &#34;CAD&#34;, 
                     bank_account_id: str = None, 
                     account_id: Optional[str] = None):
        &#34;&#34;&#34;
        Make a deposit under your Wealthsimple Trade account. 
        Where ***amount*** is the amount to deposit  
        Where ***currency*** is the currency need to be transferred: autoset to &#34;CAD&#34;  
        Where ***bank_account_id*** is id of bank account.  
        Where ***account_id*** is id of the account.  
        &#34;&#34;&#34;
        logger.debug(&#34;make_deposits&#34;)
        if bank_account_id == None:
            bank_account_id = self.get_bank_accounts()[&#34;results&#34;][0][&#34;id&#34;]
        if account_id == None:
            account_id = self.get_trade_account_id(tokens)
        person = self.get_person()
        payload = {
            &#34;client_id&#34;: str(person[&#34;id&#34;]),
            &#34;bank_account_id&#34;: str(bank_account_id),
            &#34;account_id&#34;: str(account_id),
            &#34;amount&#34;: float(amount),
            &#34;currency&#34;: str(currency)
        }
        r = requests.post(
            url=&#39;{}deposits&#39;.format(self.base_url),
            headers=tokens[0],
            data=payload
        )
        logger.debug(f&#34;make_deposits {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_deposit(self, tokens, funds_transfer_id: str):
        &#34;&#34;&#34;
        Get specific deposit under this Wealthsimple Trade account.  
        Where ***funds_transfer_id*** is the id of the deposit  
        &#34;&#34;&#34;
        logger.debug(&#34;get_deposits&#34;)
        r = requests.get(
            url=&#34;{}deposits/{}&#34;.format(self.base_url, funds_transfer_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_deposits {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def list_deposits(self, tokens):
        &#34;&#34;&#34;
        Get all deposits under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        logger.debug(&#34;list_deposits&#34;)
        r = requests.get(
            url=&#34;{}deposits&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;list_deposits {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def delete_deposit(self, tokens, funds_transfer_id: str):
        &#34;&#34;&#34;
        Delete a specific deposit under your Wealthsimple Trade account.
        &#34;&#34;&#34;
        logger.debug(&#34;delete_deposits&#34;)
        r = requests.delete(
            url=&#34;{}deposits/{}&#34;.format(self.base_url, funds_transfer_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;delete_deposits {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! market related functions
    def get_all_markets(self, tokens):
        &#34;&#34;&#34;
        Grabs all market data including opening and closing hours 
        &#34;&#34;&#34;
        logger.debug(&#34;get_all_markets&#34;)
        r = requests.get(
            url=&#39;{}markets&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_all_markets {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_market_hours(self, tokens, exchange: str):
        &#34;&#34;&#34;
        Get all market data about a specific exchange.  
        Where ***exchange*** is the exchange name.
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;get_market_hours&#34;)
            exchanges = list(self.exh_to_mic.keys())
            if exchange in exchanges:
                all_markets = self.get_all_markets(tokens)[&#39;results&#39;]
                for market in all_markets:
                    if market[&#34;exchange_name&#34;] == exchange:
                        return market
            else:
                return {}
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    #! watchlist functions
    def get_watchlist(self, tokens):
        &#34;&#34;&#34;
        Get all watchlisted securities under your Wealthsimple trade account. 
        &#34;&#34;&#34;
        logger.debug(&#34;get_watchlist&#34;)
        r = requests.get(
            url=&#34;{}watchlist&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_watchlist {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def add_watchlist(self, tokens, sec_id: str):
        &#34;&#34;&#34;
        Add security under this Wealthsimple Trade account.    
        Where ***sec_id*** is the security id for the security you want to add.            
        &#34;&#34;&#34;
        logger.debug(&#34;add_watchlist&#34;)
        r = requests.put(
            url=&#34;{}watchlist/{}&#34;.format(self.base_url, sec_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;add_watchlist {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def delete_watchlist(self, tokens, sec_id: str):
        &#34;&#34;&#34;
        Delete a watchlisted securities in your Wealthsimple Trade account.  
        Where ***sec_id*** is the security id for the security you want to delete. 
        &#34;&#34;&#34;
        logger.debug(&#34;delete_watchlist&#34;)
        r = requests.delete(
            url=&#34;{}watchlist/{}&#34;.format(self.base_url, sec_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;delete_watchlist {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! exchange functions
    def get_exchange_rate(self, tokens):
        &#34;&#34;&#34;
        Current Wealthsimple Trade forex USD/CAD exchange rates. 
        &#34;&#34;&#34;
        logger.debug(&#34;get_exchange_rate&#34;)
        r = requests.get(
            url=&#34;{}forex&#34;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_exchange_rate {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! fact-sheet functions
    def get_fact_sheets(self, tokens):
        &#34;&#34;&#34;
        Get all fact-sheets that you have access to under your Wealthsimple account
        &#34;&#34;&#34;
        logger.debug(&#34;get_fact_sheets&#34;)
        r = requests.get(
            url=&#39;{}fact-sheets&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_fact_sheets {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    #! securities groups functions
    def get_top_losers_securities(self,
                                  tokens,
                                  offset: int = 0,
                                  limit: int = 20):
        &#34;&#34;&#34;
        Grab a list of top losers securities under Wealthsimple trade today.
        Where ***offset*** is the displacement between the selected offset and the beginning.   
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_top_losers_securities&#34;)
        r = requests.get(
            url=&#39;{}securities/top_market_movers&#39;.format(self.base_url),
            params={&#34;type&#34;:&#34;losers&#34;,&#34;limit&#34;:limit,&#34;offset&#34;:offset},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_top_losers_securities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json() 

    def get_top_gainers_securities(self,
                                   tokens,
                                   offset: int = 0,
                                   limit: int = 20):
        &#34;&#34;&#34;
        Grab a list of top gainers securities under Wealthsimple trade today.
        Where ***offset*** is the displacement between the selected offset and the beginning.   
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_top_gainers_securities&#34;)
        r = requests.get(
            url=&#39;{}securities/top_market_movers&#39;.format(self.base_url),
            params={&#34;type&#34;:&#34;gainers&#34;,&#34;limit&#34;:limit,&#34;offset&#34;:offset},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_top_gainers_securities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()  
    
    def get_most_active_securities(self,
                                   tokens,
                                   limit: int = 20):
        &#34;&#34;&#34;
        Grab a list of most active securities under Wealthsimple trade today.  
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_most_active_securities&#34;)
        r = requests.get(
            url=&#39;{}securities/top_market_movers&#39;.format(self.base_url),
            params={&#34;type&#34;:&#34;most_active&#34;,&#34;limit&#34;:limit},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_most_active_securities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()      
    
    def get_most_watched_securities(self,
                                    tokens,
                                    offset: int = 0,
                                    limit: int = 20):
        &#34;&#34;&#34;
        Grabs all most watched securities under Wealthsimple trade today.
        Where ***offset*** is the displacement between the selected offset and the beginning.   
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_most_watched_securities&#34;)
        r = requests.get(
            url=&#39;{}securities/most_watched&#39;.format(self.base_url),
            params={&#34;limit&#34;:limit,&#34;offset&#34;:offset},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_most_watched_securities {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()    
    
    def get_featured_security_groups(self, tokens):
        &#34;&#34;&#34;
        Grabs all featured security groups under Wealthsimple trade today
        &#34;&#34;&#34;
        logger.debug(&#34;get_featured_security_groups&#34;)
        r = requests.get(
            url=&#39;{}security-groups/featured&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_featured_security_groups {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
    
    def get_securities_in_groups(self, 
                                 tokens,
                                 group_id: str,
                                 offset: int = 0,
                                 limit: int = 20,
                                 filter_type: str = None):
        &#34;&#34;&#34;
        Grabs all securities groups under Wealthsimple trade. 
        Where ***filter_type*** - &#34;most_watched&#34; ? 
        Where ***offset*** is the displacement between the selected offset and the beginning.   
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_securities_in_groups&#34;)
        r = requests.get(
            url=&#39;{}security-groups/{}/securities&#39;.format(self.base_url, group_id),
            params={&#34;limit&#34;:limit,&#34;offset&#34;:offset,&#34;filter_type&#34;:filter_type},
            headers=tokens[0]
        )        
        logger.debug(f&#34;get_securities_in_groups {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
    
    def get_all_securities_groups(self, 
                                  tokens,
                                  offset: int = 0,
                                  limit: int = 25,
                                  order: str = &#34;desc&#34;):
        &#34;&#34;&#34;
        Grabs all security groups under Wealthsimple trade  
        Where ***offset*** is &gt;= 0: autoset to 0  
        Where ***limit*** is the limitation of the response, (1 &lt;= limit &lt; 99): autoset to 25  
        Where ***sort_order*** is order of the results and can be [&#34;asc&#34;, &#34;desc&#34;]: autoset to &#34;desc&#34;  
        &#34;&#34;&#34;
        logger.debug(&#34;get_all_securities_groups&#34;)
        r = requests.get(
            url=&#34;{}security-groups&#34;.format(self.base_url),
            params={&#34;offset&#34;:offset, &#34;limit&#34;:limit, &#34;sort_order&#34;:order},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_all_securities_groups {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            print(r.status_code)
            return r.json()
        
    #! mobile dashboard functions
    def get_mobile_dashboard(self, tokens):
        &#34;&#34;&#34;
        Get all info in the mobile dashboard
        &#34;&#34;&#34;
        logger.debug(&#34;get_mobile_dashboard&#34;)
        r = requests.get(
            url=&#39;{}mobile-dashboard&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_mobile_dashboard {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
     
    #! global alerts
    def get_alerts(self, tokens):
        &#34;&#34;&#34;
        Grab all global alerts
        &#34;&#34;&#34;
        logger.debug(&#34;get_alerts&#34;)
        result = {}
        r_user = requests.get(
            url=&#39;{}global-alerts/user&#39;.format(self.base_url),
            headers=tokens[0]
        )
        r_all = requests.get(
            url=&#39;{}global-alerts&#39;.format(self.base_url),
            headers=tokens[0]
        ) 
        result[&#34;user&#34;] = r_user.json()[&#34;results&#34;]
        result[&#34;all&#34;] = r_all.json()[&#34;results&#34;]
        logger.debug(f&#34;get_alerts user:{r_user.status_code} all:{r_all.status_code}&#34;)
        if (r_user.status_code == 401 or r_all.status_code == 401) :
            raise InvalidAccessTokenError
        else:
            return result
     
    #! internal transfers 
    def get_supported_internal_transfers(self, tokens):
        &#34;&#34;&#34;
        Grabs a list of all support interal transfers
        &#34;&#34;&#34;
        logger.debug(&#34;get_supported_internal_transfers&#34;)
        r = requests.get(
            url=&#39;{}supported-internal-transfers&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_supported_internal_transfers {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
     
    def create_internal_transfers(self, tokens, payload):
        &#34;&#34;&#34;
        create a internal transfer request  
        currently no wrapper functions.
        &#34;&#34;&#34;
        logger.debug(&#34;create_internal_transfers&#34;)
        r = requests.post(
            url=&#39;{}internal_transfers&#39;.format(self.base_url),
            headers=tokens[0],
            data=payload
        )
        logger.debug(f&#34;create_internal_transfers {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()    
    
    #! tax-documents
    def get_tax_documents(self, 
                          tokens, 
                          account_id: Optional[str] = None):
        &#34;&#34;&#34;
        Grab tax documents of your Wealthsimple account
        &#34;&#34;&#34;
        logger.debug(&#34;get_tax_documents&#34;)
        if account_id is None:
            account_id = self.get_trade_account_id(tokens)
        r = requests.get(
            url=&#39;{}tax-documents&#39;.format(self.base_url),
            param={&#34;account_id&#34;, account_id},
            headers=tokens[0]
        )
        logger.debug(f&#34;get_tax_documents {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
     
    #! monthly-statements
    def get_monthly_statements(self, tokens):
        &#34;&#34;&#34;
        Grabs all monthly statements under your Wealthsimple account
        &#34;&#34;&#34;
        logger.debug(&#34;get_monthly_statements&#34;)
        r = requests.get(
            url=&#39;{}monthly-statements&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_monthly_statements {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()
    
    def get_monthly_statements_url(self, tokens, pdf_statement_id):
        &#34;&#34;&#34;
        Grabs a url to a pdf of your statement.  
        Where ***pdf_statement_id*** is the id of the month you want to get.  
        &#34;&#34;&#34;
        logger.debug(&#34;get_monthly_statements&#34;)
        r = requests.get(
            url=&#39;{}monthly-statements/{}&#39;.format(self.base_url, pdf_statement_id),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_monthly_statements {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()

    def get_monthly_statements_cleaned(self, tokens):
        &#34;&#34;&#34;
        Grabs all monthly statements under your Wealthsimple account.  
        Is diffrent from ***get_monthly_statements*** as it clean the response data.   
        &#34;&#34;&#34;
        try:
            logger.debug(&#34;get_all_monthly_statements&#34;)
            monthly_statements_data = self.get_monthly_statements(tokens)[&#34;results&#34;]
            result = []
            for data in monthly_statements_data:
                inner_dict = {}
                inner_dict[&#34;created_at&#34;] = data[&#34;created_at&#34;]
                inner_dict[&#34;updated_at&#34;] = data[&#34;updated_at&#34;]
                inner_dict[&#34;period&#34;] = data[&#34;period&#34;]
                inner_dict[&#34;id&#34;] = data[&#34;id&#34;]
                inner_dict[&#34;url&#34;] = self.get_monthly_statements_url(tokens, data[&#34;id&#34;])[&#34;url&#34;]
                result.append(inner_dict)
            logger.debug(f&#34;get_all_monthly_statements ^^^&#34;)    
            return result
                        
        except InvalidAccessTokenError:
            raise InvalidAccessTokenError

    #! websocket_ticket
    def get_websocket_ticket(self, tokens):
        &#34;&#34;&#34;
        Grabs a websocket ticket, need to connect to the wealthsimple websocket 
        url for accessing websocket is:
        &#34;wss://trade-service.wealthsimple.com/websocket?ticket={}&amp;version=2&#34;.format(ticket) 
        &#34;&#34;&#34;
        logger.debug(&#34;get_websocket_ticket&#34;)
        r = requests.post(
            url=&#39;{}websocket-ticket&#39;.format(self.base_url),
            headers=tokens[0]
        )
        logger.debug(f&#34;get_websocket_ticket {r.status_code}&#34;)
        if r.status_code == 401:
            raise InvalidAccessTokenError
        else:
            return r.json()  

    #! functions after this point are not core to the API
    def test_endpoint(self, tokens):
        &#34;&#34;&#34;
        function for testing new endpoints
        &#34;&#34;&#34;
        logger.debug(&#34;test endpoint&#34;)
        r = requests.post(&#34;{}test&#34;.format(self.base_url),
                    headers=tokens[0]
                    )
        print(f&#34;{r.status_code} {r.url}&#34;)
        print(r.headers)
        print(r.content)
        # print(r.json())
        return r.json()

    def settings(self, tokens):
        &#34;&#34;&#34;
        Get settings data needed for settings page.
        &#34;&#34;&#34;
        logger.debug(&#34;starting settings&#34;)
        try:
            me = self.get_me(tokens)
            person = self.get_person(tokens)
            bank_account = self.get_bank_accounts(tokens)
            exchange_rate = self.get_exchange_rate(tokens)
            ws_current_operational_status = self.current_status()
            return {
                &#39;me&#39;: me,
                &#39;person&#39;: person,
                &#39;bank_account&#39;: bank_account,
                &#39;exchange_rate&#39;: exchange_rate,
                &#39;ws_current_operational_status&#39;: ws_current_operational_status
            }
        except InvalidAccessTokenError:
            logger.debug(&#34;settings InvalidAccessTokenError&#34;)
            raise InvalidAccessTokenError

    def stock(self,
              tokens,
              sec_id: str,
              time: str = &#34;1d&#34;):
        &#34;&#34;&#34;
        Get security data needed for stock search pages.
        &#34;&#34;&#34;
        logger.debug(&#34;starting stock {}&#34;.format(sec_id))
        try:
            sparkline = self.find_securities_by_id_historical(tokens, sec_id, time)
            security_info = self.find_securities_by_id(tokens, sec_id)
            news = self.public_find_securities_news(security_info[&#34;stock&#34;][&#34;symbol&#34;])
            position = self.get_account(tokens)
            return {
                &#34;sparkline&#34;: sparkline,
                &#34;security_info&#34;: security_info,
                &#34;position&#34;: position,
                &#34;news&#34;: news 
            }
        except InvalidAccessTokenError:
            logger.error(&#34;stock InvalidAccessTokenError&#34;)
            raise InvalidAccessTokenError
        
    def search_page(self, tokens):
        &#34;&#34;&#34;
        Get groups need for search page
        &#34;&#34;&#34;
        try:
            featured_security_groups = self.get_featured_security_groups(tokens)
            get_top_losers_securities = self.get_top_losers_securities(tokens, limit=5)
            get_top_gainers_securities = self.get_top_gainers_securities(tokens, limit=5)
            get_most_active_securities = self.get_most_active_securities(tokens, limit=5)
            get_most_watched_securities = self.get_most_watched_securities(tokens, limit=5)
            return {
                &#34;featured_security_groups&#34;: featured_security_groups,
                &#34;most_watched&#34;: get_most_watched_securities,
                &#34;most_active&#34;: get_most_active_securities,
                &#34;top_gainers&#34;: get_top_gainers_securities,
                &#34;top_losers&#34;: get_top_losers_securities,
            }
        except InvalidAccessTokenError:
            logger.error(&#34;search_page InvalidAccessTokenError&#34;)
            raise InvalidAccessTokenError

    def dashboard(self, tokens):
        &#34;&#34;&#34;
        Get dashboard page needed for home page.    
        &#34;&#34;&#34;
        logger.debug(&#34;calling dashboard&#34;)
        try:
            mobile_dashboard = self.get_mobile_dashboard(tokens)
            account_data = self.get_historical_portfolio_data(tokens)
            
            account = mobile_dashboard[&#34;accounts&#34;][0]
            watchlist = mobile_dashboard[&#34;watchlist&#34;]
            positions = mobile_dashboard[&#34;positions&#34;]
            previous_amount = account_data[&#34;previous_close_net_liquidation_value&#34;][&#39;amount&#39;]
            total_value = account_data[&#34;results&#34;][-1][&#34;value&#34;]
            account_value_graph = account_data[&#34;results&#34;]
            account_change = round(total_value[&#39;amount&#39;] - previous_amount, 2)
            account_change_percentage = round((account_change / previous_amount)*100, 2)
            return {
                &#39;available_to_trade&#39;: {
                    &#39;amount&#39;: account[&#39;buying_power&#39;][&#39;amount&#39;],
                    &#39;currency&#39;: account[&#39;buying_power&#39;][&#39;currency&#39;]
                },
                &#39;account_value&#39;: {
                    &#39;amount&#39;: total_value[&#39;amount&#39;],
                    &#39;currency&#39;: total_value[&#39;currency&#39;]
                },
                &#39;net_deposits&#39;: {
                    &#39;amount&#39;: account[&#39;net_deposits&#39;][&#39;amount&#39;],
                    &#39;currency&#39;: account[&#39;net_deposits&#39;][&#39;currency&#39;]
                },
                &#39;available_to_withdraw&#39;: {
                    &#39;amount&#39;: account[&#39;available_to_withdraw&#39;][&#39;amount&#39;],
                    &#39;currency&#39;: account[&#39;available_to_withdraw&#39;][&#39;currency&#39;]
                },
                &#39;account_change&#39;: {
                    &#39;amount&#39;: account_change,
                    &#39;percentage&#39;: account_change_percentage
                },
                &#39;account_value_graph&#39;: {
                    &#39;table&#39;: account_value_graph
                },
                &#39;account_positions&#39;: {
                    &#39;table&#39;: positions
                },
                &#39;account_watchlist&#39;: {
                    &#39;table&#39;: watchlist
                }
            }
        except InvalidAccessTokenError:
            logger.error(&#34;dashboard InvalidAccessTokenError&#34;)
            raise InvalidAccessTokenError

    #! public prefix functions
    @staticmethod
    def public_find_securities_by_ticker(ticker):
        &#34;&#34;&#34;
        Grabs information about the security resembled by the ticker.  
        Where ***ticker*** is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.
        !May not work on smaller companies or ETFs. 
        &#34;&#34;&#34;
        base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
        r = requests.get(
            url=&#34;{}securities/{}&#34;.format(base_url_public, ticker)
        )
        return r.json()

    @staticmethod
    def public_find_securities_by_ticker_historical(ticker, time):
        &#34;&#34;&#34;
        Get a company historical data based on a time.    
        Where ***ticker*** is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.  
        Where ***time*** is (&#34;1d&#34;, &#34;1w&#34;, &#34;1m&#34;, &#34;3m&#34;, &#34;1y&#34;): DOES NOT INCLUDE (&#34;all&#34;).   
        !May not work on smaller companies or ETFs.  
        &#34;&#34;&#34;
        base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
        r = requests.get(
            url=&#34;{}securities/{}/historical_quotes/{}&#34;.format(
                base_url_public, ticker, time)
        )
        return r.json()

    @staticmethod
    def public_top_traded(offset: int = 0, limit: int = 5):
        &#34;&#34;&#34;
        Get top traded companies on Wealthsimple trade.  
        Where ***offset*** is the displacement between the selected offset and the beginning.   
        Where ***limit*** is the amount of response you want from the request.  
        &#34;&#34;&#34;
        base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
        r = requests.get(
            url=&#34;{}securities/top_traded&#34;.format(base_url_public),
            params={&#34;offset&#34;: offset,&#34;limit&#34;:limit}
        )
        return r.json()

    @staticmethod
    def public_find_securities_news(ticker):
        &#34;&#34;&#34;
        Get public news based on the ticker.    
        Where ***ticker*** is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.   
        !May not work on smaller companies or ETF. 
        &#34;&#34;&#34;
        base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
        r = requests.get(
            url=&#34;{}securities/{}/news&#34;.format(base_url_public, ticker)
        )
        return r.json()

    #! public prefix functions: wealthsimple operational status
    @staticmethod
    def summary_status():
        &#34;&#34;&#34;
        Get current summary status/incidents of Wealthsimple trade.     
        This function returns data on these systems:  
        Login and Account Access, Deposits and Withdrawals,   
        Security Search, Order execution, Order submission,   
        Order Cancellation, Linking bank accounts,   
        Quotes, Order status, Trading, Market Data,  
        Account Values, Account Opening,   
        Apps, iOS app, Android App  
        the data is in the body(content), data is large.  
        &#34;&#34;&#34;
        r = requests.get(
            url=&#34;https://status.wealthsimple.com/api/v2/summary.json&#34;
        )
        return json.loads(r.content)

    @staticmethod
    def current_status():
        &#34;&#34;&#34;
        Get current status/incidents of wealthsimple trade.    
        the data is in body(content), data could be large. 
        &#34;&#34;&#34;
        r = requests.get(
            url=&#34;https://status.wealthsimple.com/api/v2/status.json&#34;
        )
        return json.loads(r.content)

    @staticmethod
    def historical_status():
        &#34;&#34;&#34;
        Get all previous history status/incidents of wealthsimple trade.   
        the data is in body(content), data could be large. 
        &#34;&#34;&#34;
        r = requests.get(
            url=&#34;https://status.wealthsimple.com/api/v2/incidents.json&#34;
        )
        return json.loads(r.content)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="api.api.Wsimple.activities_types"><code class="name">var <span class="ident">activities_types</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="api.api.Wsimple.bank_logos"><code class="name">var <span class="ident">bank_logos</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="api.api.Wsimple.base_url"><code class="name">var <span class="ident">base_url</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="api.api.Wsimple.exchanges"><code class="name">var <span class="ident">exchanges</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="api.api.Wsimple.exh_to_mic"><code class="name">var <span class="ident">exh_to_mic</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="api.api.Wsimple.friendly_account_name"><code class="name">var <span class="ident">friendly_account_name</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="api.api.Wsimple.time_ranges"><code class="name">var <span class="ident">time_ranges</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Static methods</h3>
<dl>
<dt id="api.api.Wsimple.current_status"><code class="name flex">
<span>def <span class="ident">current_status</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Get current status/incidents of wealthsimple trade.
<br>
the data is in body(content), data could be large.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def current_status():
    &#34;&#34;&#34;
    Get current status/incidents of wealthsimple trade.    
    the data is in body(content), data could be large. 
    &#34;&#34;&#34;
    r = requests.get(
        url=&#34;https://status.wealthsimple.com/api/v2/status.json&#34;
    )
    return json.loads(r.content)</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.historical_status"><code class="name flex">
<span>def <span class="ident">historical_status</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Get all previous history status/incidents of wealthsimple trade. <br>
the data is in body(content), data could be large.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def historical_status():
    &#34;&#34;&#34;
    Get all previous history status/incidents of wealthsimple trade.   
    the data is in body(content), data could be large. 
    &#34;&#34;&#34;
    r = requests.get(
        url=&#34;https://status.wealthsimple.com/api/v2/incidents.json&#34;
    )
    return json.loads(r.content)</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.oauth_login"><code class="name flex">
<span>def <span class="ident">oauth_login</span></span>(<span>token_dict, verbose=False)</span>
</code></dt>
<dd>
<div class="desc"><p>constructor: login with a predefined list of tokens:</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@classmethod
def oauth_login(cls, token_dict, verbose=False):
    &#34;&#34;&#34;
    constructor: login with a predefined list of tokens:
    &#34;&#34;&#34;
    wsimple = cls(&#34;&#34;, &#34;&#34;, oauth_mode=True, tokens=token_dict, verbose_mode=verbose)
    return wsimple</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.otp_login"><code class="name flex">
<span>def <span class="ident">otp_login</span></span>(<span>email, password, otp_number, verbose=False)</span>
</code></dt>
<dd>
<div class="desc"><p>constructor: login with a otp code:</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@classmethod
def otp_login(cls,
              email,
              password,
              otp_number,
              verbose=False):
    &#34;&#34;&#34;
    constructor: login with a otp code:
    &#34;&#34;&#34;
    wsimple = cls(email, password, otp_mode=True, otp_number=int(otp_number))
    return wsimple </code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.public"><code class="name flex">
<span>def <span class="ident">public</span></span>(<span>verbose=False)</span>
</code></dt>
<dd>
<div class="desc"><p>constructor: Use Wsimple.public functions without an wealthsimple account:</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@classmethod
def public(cls, verbose=False):
    &#34;&#34;&#34;
    constructor: Use Wsimple.public functions without an wealthsimple account:
    &#34;&#34;&#34;
    wsimple = cls(&#34;&#34;, &#34;&#34;, public_mode=True, verbose_mode=verbose)
    return wsimple</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.public_find_securities_by_ticker"><code class="name flex">
<span>def <span class="ident">public_find_securities_by_ticker</span></span>(<span>ticker)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs information about the security resembled by the ticker.<br>
Where <strong><em>ticker</em></strong> is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.
!May not work on smaller companies or ETFs.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def public_find_securities_by_ticker(ticker):
    &#34;&#34;&#34;
    Grabs information about the security resembled by the ticker.  
    Where ***ticker*** is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.
    !May not work on smaller companies or ETFs. 
    &#34;&#34;&#34;
    base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
    r = requests.get(
        url=&#34;{}securities/{}&#34;.format(base_url_public, ticker)
    )
    return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.public_find_securities_by_ticker_historical"><code class="name flex">
<span>def <span class="ident">public_find_securities_by_ticker_historical</span></span>(<span>ticker, time)</span>
</code></dt>
<dd>
<div class="desc"><p>Get a company historical data based on a time.
<br>
Where <strong><em>ticker</em></strong> is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.<br>
Where <strong><em>time</em></strong> is ("1d", "1w", "1m", "3m", "1y"): DOES NOT INCLUDE ("all"). <br>
!May not work on smaller companies or ETFs.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def public_find_securities_by_ticker_historical(ticker, time):
    &#34;&#34;&#34;
    Get a company historical data based on a time.    
    Where ***ticker*** is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.  
    Where ***time*** is (&#34;1d&#34;, &#34;1w&#34;, &#34;1m&#34;, &#34;3m&#34;, &#34;1y&#34;): DOES NOT INCLUDE (&#34;all&#34;).   
    !May not work on smaller companies or ETFs.  
    &#34;&#34;&#34;
    base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
    r = requests.get(
        url=&#34;{}securities/{}/historical_quotes/{}&#34;.format(
            base_url_public, ticker, time)
    )
    return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.public_find_securities_news"><code class="name flex">
<span>def <span class="ident">public_find_securities_news</span></span>(<span>ticker)</span>
</code></dt>
<dd>
<div class="desc"><p>Get public news based on the ticker.
<br>
Where <strong><em>ticker</em></strong> is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY. <br>
!May not work on smaller companies or ETF.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def public_find_securities_news(ticker):
    &#34;&#34;&#34;
    Get public news based on the ticker.    
    Where ***ticker*** is the ticker of the company or ETF. Ex. AMZN, APPL, GOOGL, SPY.   
    !May not work on smaller companies or ETF. 
    &#34;&#34;&#34;
    base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
    r = requests.get(
        url=&#34;{}securities/{}/news&#34;.format(base_url_public, ticker)
    )
    return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.public_top_traded"><code class="name flex">
<span>def <span class="ident">public_top_traded</span></span>(<span>offset:int=0, limit:int=5)</span>
</code></dt>
<dd>
<div class="desc"><p>Get top traded companies on Wealthsimple trade.<br>
Where <strong><em>offset</em></strong> is the displacement between the selected offset and the beginning. <br>
Where <strong><em>limit</em></strong> is the amount of response you want from the request.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def public_top_traded(offset: int = 0, limit: int = 5):
    &#34;&#34;&#34;
    Get top traded companies on Wealthsimple trade.  
    Where ***offset*** is the displacement between the selected offset and the beginning.   
    Where ***limit*** is the amount of response you want from the request.  
    &#34;&#34;&#34;
    base_url_public = &#34;https://trade-service.wealthsimple.com/public/&#34;
    r = requests.get(
        url=&#34;{}securities/top_traded&#34;.format(base_url_public),
        params={&#34;offset&#34;: offset,&#34;limit&#34;:limit}
    )
    return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.summary_status"><code class="name flex">
<span>def <span class="ident">summary_status</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Get current summary status/incidents of Wealthsimple trade.
<br>
This function returns data on these systems:<br>
Login and Account Access, Deposits and Withdrawals, <br>
Security Search, Order execution, Order submission, <br>
Order Cancellation, Linking bank accounts, <br>
Quotes, Order status, Trading, Market Data,<br>
Account Values, Account Opening, <br>
Apps, iOS app, Android App<br>
the data is in the body(content), data is large.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def summary_status():
    &#34;&#34;&#34;
    Get current summary status/incidents of Wealthsimple trade.     
    This function returns data on these systems:  
    Login and Account Access, Deposits and Withdrawals,   
    Security Search, Order execution, Order submission,   
    Order Cancellation, Linking bank accounts,   
    Quotes, Order status, Trading, Market Data,  
    Account Values, Account Opening,   
    Apps, iOS app, Android App  
    the data is in the body(content), data is large.  
    &#34;&#34;&#34;
    r = requests.get(
        url=&#34;https://status.wealthsimple.com/api/v2/summary.json&#34;
    )
    return json.loads(r.content)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="api.api.Wsimple.add_watchlist"><code class="name flex">
<span>def <span class="ident">add_watchlist</span></span>(<span>self, tokens, sec_id:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Add security under this Wealthsimple Trade account.
<br>
Where <strong><em>sec_id</em></strong> is the security id for the security you want to add.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_watchlist(self, tokens, sec_id: str):
    &#34;&#34;&#34;
    Add security under this Wealthsimple Trade account.    
    Where ***sec_id*** is the security id for the security you want to add.            
    &#34;&#34;&#34;
    logger.debug(&#34;add_watchlist&#34;)
    r = requests.put(
        url=&#34;{}watchlist/{}&#34;.format(self.base_url, sec_id),
        headers=tokens[0]
    )
    logger.debug(f&#34;add_watchlist {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.cancel_order"><code class="name flex">
<span>def <span class="ident">cancel_order</span></span>(<span>self, tokens, order_id:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Cancels a order by its id.
<br>
Where <strong><em>order</em></strong> is order_id.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cancel_order(self, tokens, order_id: str):
    &#34;&#34;&#34;
    Cancels a order by its id.    
    Where ***order*** is order_id.   
    &#34;&#34;&#34;
    logger.debug(&#34;cancel_order&#34;)
    r = requests.delete(
        &#34;{}orders/{}&#34;.format(self.base_url, order_id),
        headers=tokens[0]
    )
    logger.debug(f&#34;cancel_order {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.cancel_pending_orders"><code class="name flex">
<span>def <span class="ident">cancel_pending_orders</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>cancel all pending order</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cancel_pending_orders(self, tokens):
    &#34;&#34;&#34; cancel all pending order &#34;&#34;&#34;
    try:
        pending = self.pending_orders(tokens)
        result = []
        for orders in pending:
            result.append(self.cancel_order(tokens, orders[&#34;order_id&#34;]))
        return result
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.cancelled_orders"><code class="name flex">
<span>def <span class="ident">cancelled_orders</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all cancelled orders under your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cancelled_orders(self, tokens):
    &#34;&#34;&#34;
    Grabs all cancelled orders under your Wealthsimple Trade account.
    &#34;&#34;&#34;
    try:
        orders = self.get_orders(tokens)[&#39;results&#39;]
        result = []
        for order in orders:
            if order[&#39;status&#39;] == &#39;cancelled&#39;:
                result.append(order)
        return result
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.create_internal_transfers"><code class="name flex">
<span>def <span class="ident">create_internal_transfers</span></span>(<span>self, tokens, payload)</span>
</code></dt>
<dd>
<div class="desc"><p>create a internal transfer request<br>
currently no wrapper functions.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_internal_transfers(self, tokens, payload):
    &#34;&#34;&#34;
    create a internal transfer request  
    currently no wrapper functions.
    &#34;&#34;&#34;
    logger.debug(&#34;create_internal_transfers&#34;)
    r = requests.post(
        url=&#39;{}internal_transfers&#39;.format(self.base_url),
        headers=tokens[0],
        data=payload
    )
    logger.debug(f&#34;create_internal_transfers {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()    </code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.dashboard"><code class="name flex">
<span>def <span class="ident">dashboard</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Get dashboard page needed for home page.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dashboard(self, tokens):
    &#34;&#34;&#34;
    Get dashboard page needed for home page.    
    &#34;&#34;&#34;
    logger.debug(&#34;calling dashboard&#34;)
    try:
        mobile_dashboard = self.get_mobile_dashboard(tokens)
        account_data = self.get_historical_portfolio_data(tokens)
        
        account = mobile_dashboard[&#34;accounts&#34;][0]
        watchlist = mobile_dashboard[&#34;watchlist&#34;]
        positions = mobile_dashboard[&#34;positions&#34;]
        previous_amount = account_data[&#34;previous_close_net_liquidation_value&#34;][&#39;amount&#39;]
        total_value = account_data[&#34;results&#34;][-1][&#34;value&#34;]
        account_value_graph = account_data[&#34;results&#34;]
        account_change = round(total_value[&#39;amount&#39;] - previous_amount, 2)
        account_change_percentage = round((account_change / previous_amount)*100, 2)
        return {
            &#39;available_to_trade&#39;: {
                &#39;amount&#39;: account[&#39;buying_power&#39;][&#39;amount&#39;],
                &#39;currency&#39;: account[&#39;buying_power&#39;][&#39;currency&#39;]
            },
            &#39;account_value&#39;: {
                &#39;amount&#39;: total_value[&#39;amount&#39;],
                &#39;currency&#39;: total_value[&#39;currency&#39;]
            },
            &#39;net_deposits&#39;: {
                &#39;amount&#39;: account[&#39;net_deposits&#39;][&#39;amount&#39;],
                &#39;currency&#39;: account[&#39;net_deposits&#39;][&#39;currency&#39;]
            },
            &#39;available_to_withdraw&#39;: {
                &#39;amount&#39;: account[&#39;available_to_withdraw&#39;][&#39;amount&#39;],
                &#39;currency&#39;: account[&#39;available_to_withdraw&#39;][&#39;currency&#39;]
            },
            &#39;account_change&#39;: {
                &#39;amount&#39;: account_change,
                &#39;percentage&#39;: account_change_percentage
            },
            &#39;account_value_graph&#39;: {
                &#39;table&#39;: account_value_graph
            },
            &#39;account_positions&#39;: {
                &#39;table&#39;: positions
            },
            &#39;account_watchlist&#39;: {
                &#39;table&#39;: watchlist
            }
        }
    except InvalidAccessTokenError:
        logger.error(&#34;dashboard InvalidAccessTokenError&#34;)
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.delete_deposit"><code class="name flex">
<span>def <span class="ident">delete_deposit</span></span>(<span>self, tokens, funds_transfer_id:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Delete a specific deposit under your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_deposit(self, tokens, funds_transfer_id: str):
    &#34;&#34;&#34;
    Delete a specific deposit under your Wealthsimple Trade account.
    &#34;&#34;&#34;
    logger.debug(&#34;delete_deposits&#34;)
    r = requests.delete(
        url=&#34;{}deposits/{}&#34;.format(self.base_url, funds_transfer_id),
        headers=tokens[0]
    )
    logger.debug(f&#34;delete_deposits {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.delete_watchlist"><code class="name flex">
<span>def <span class="ident">delete_watchlist</span></span>(<span>self, tokens, sec_id:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Delete a watchlisted securities in your Wealthsimple Trade account.<br>
Where <strong><em>sec_id</em></strong> is the security id for the security you want to delete.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_watchlist(self, tokens, sec_id: str):
    &#34;&#34;&#34;
    Delete a watchlisted securities in your Wealthsimple Trade account.  
    Where ***sec_id*** is the security id for the security you want to delete. 
    &#34;&#34;&#34;
    logger.debug(&#34;delete_watchlist&#34;)
    r = requests.delete(
        url=&#34;{}watchlist/{}&#34;.format(self.base_url, sec_id),
        headers=tokens[0]
    )
    logger.debug(f&#34;delete_watchlist {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.delete_withdrawal"><code class="name flex">
<span>def <span class="ident">delete_withdrawal</span></span>(<span>self, tokens, funds_transfer_id:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Delete a specific withdrawal your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_withdrawal(self, tokens, funds_transfer_id: str):
    &#34;&#34;&#34;
    Delete a specific withdrawal your Wealthsimple Trade account.
    &#34;&#34;&#34;
    logger.debug(&#34;delete_withdrawal&#34;)
    r = requests.delete(
        url=&#34;{}withdrawals/{}&#34;.format(self.base_url, funds_transfer_id),
        headers=tokens[0]
    )
    logger.debug(f&#34;delete_withdrawal {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.filled_orders"><code class="name flex">
<span>def <span class="ident">filled_orders</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all filled orders under your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def filled_orders(self, tokens):
    &#34;&#34;&#34;
    Grabs all filled orders under your Wealthsimple Trade account.
    &#34;&#34;&#34;
    try:
        orders = self.get_orders(tokens)[&#39;results&#39;]
        result = []
        for order in orders:
            if order[&#39;status&#39;] == &#39;posted&#39;:
                result.append(order)
        return result
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.find_securities"><code class="name flex">
<span>def <span class="ident">find_securities</span></span>(<span>self, tokens, ticker:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs information about the security resembled by the ticker.
<br>
Where <strong><em>ticker</em></strong> is the ticker of the company, API will fuzzy
<br>
match this argument and therefore multiple results can appear.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def find_securities(self, tokens, ticker: str):
    &#34;&#34;&#34;
    Grabs information about the security resembled by the ticker.    
    Where ***ticker*** is the ticker of the company, API will fuzzy    
    match this argument and therefore multiple results can appear. 
    &#34;&#34;&#34;
    logger.debug(&#34;find_securities&#34;)
    r = requests.get(
        url=&#34;{}securities&#34;.format(self.base_url),
        params={&#34;query&#34;: ticker},
        headers=tokens[0]
    )
    logger.debug(f&#34;find_securities {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.find_securities_by_id"><code class="name flex">
<span>def <span class="ident">find_securities_by_id</span></span>(<span>self, tokens, sec_id:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs information about the security resembled by the security id.<br>
Where <strong><em>ticker</em></strong> is the ticker of the company.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def find_securities_by_id(self, tokens, sec_id: str):
    &#34;&#34;&#34;
    Grabs information about the security resembled by the security id.  
    Where ***ticker*** is the ticker of the company. 
    &#34;&#34;&#34;
    logger.debug(&#34;find_securities_by_id&#34;)
    r = requests.get(
        url=&#34;{}securities/{}&#34;.format(self.base_url, sec_id),
        headers=tokens[0]
    )
    logger.debug(f&#34;find_securities_by_id {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.find_securities_by_id_historical"><code class="name flex">
<span>def <span class="ident">find_securities_by_id_historical</span></span>(<span>self, tokens, sec_id:str, time:str='1d', mic:str='XNAS')</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs historical information about the security by the security id in a specified timeframe.<br>
Where <strong><em>time</em></strong> is the timeframe one of [1d, 1w, 1m, 3m, 1y, all]: autoset "1d".<br>
Where <strong><em>mic</em></strong> is the Market Identifier Code for the exchange: autoset "XNAS"</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def find_securities_by_id_historical(self, 
                                     tokens,
                                     sec_id: str,
                                     time: str = &#34;1d&#34;,
                                     mic: str = &#34;XNAS&#34;):
    &#34;&#34;&#34;
    Grabs historical information about the security by the security id in a specified timeframe.  
    Where ***time*** is the timeframe one of [1d, 1w, 1m, 3m, 1y, all]: autoset &#34;1d&#34;.  
    Where ***mic*** is the Market Identifier Code for the exchange: autoset &#34;XNAS&#34;  
    &#34;&#34;&#34;
    logger.debug(&#34;find_securities_by_id_historical&#34;)
    r = requests.get(
        url=&#34;{}securities/{}/historical_quotes/{}&#34;.format(self.base_url, sec_id, time),
        params={&#34;mic&#34;:mic},
        headers=tokens[0]
    )
    logger.debug(f&#34;find_securities_by_id_historical {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_account"><code class="name flex">
<span>def <span class="ident">get_account</span></span>(<span>self, tokens, id)</span>
</code></dt>
<dd>
<div class="desc"><p>Grab a specific accounts information by id</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_account(self, tokens, id):
    &#34;&#34;&#34;
    Grab a specific accounts information by id 
    &#34;&#34;&#34;
    logger.debug(&#34;get_account call&#34;)
    r = requests.get(
        url=&#34;{}account/{}&#34;.format(self.base_url, id),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_account {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_account_ids"><code class="name flex">
<span>def <span class="ident">get_account_ids</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all account ids under your your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_account_ids(self, tokens):
    &#34;&#34;&#34;
    Grabs all account ids under your your Wealthsimple Trade account. 
    &#34;&#34;&#34;
    try:
        logger.debug(&#34;get_account_ids call&#34;)
        accounts = self.get_account(tokens)[&#34;results&#34;]
        account_ids = []
        for account in accounts:
            account_ids.append(account[&#34;id&#34;])
        logger.debug(f&#34;get_account_ids ^^^&#34;)
        return account_ids  
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_accounts"><code class="name flex">
<span>def <span class="ident">get_accounts</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all accounts information</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_accounts(self, tokens):
    &#34;&#34;&#34;
    Grabs all accounts information
    &#34;&#34;&#34;
    logger.debug(&#34;get_accounts call&#34;)
    r = requests.get(
        url=&#34;{}account/list&#34;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_account {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json() </code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_activities"><code class="name flex">
<span>def <span class="ident">get_activities</span></span>(<span>self, tokens, limit:int=20, type:str='all', account_id:Optional[str]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs the 20 most recent activities on under your Wealthsimple Trade account.
<br>
Where <strong><em>type</em></strong> is the activities type you want can be ["deposit", "withdrawal", "dividend", "buy", "sell"] autoset to all.<br>
Where <strong><em>limit</em></strong> is the limitation of the response has to be less than 100: autoset 20.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_activities(self, 
                   tokens, 
                   limit: int = 20,
                   type: str = &#34;all&#34;,
                   account_id: Optional[str] = None,
                   ):
    &#34;&#34;&#34;
    Grabs the 20 most recent activities on under your Wealthsimple Trade account.    
    Where ***type*** is the activities type you want can be [&#34;deposit&#34;, &#34;withdrawal&#34;, &#34;dividend&#34;, &#34;buy&#34;, &#34;sell&#34;] autoset to all.  
    Where ***limit*** is the limitation of the response has to be less than 100: autoset 20.         
    &#34;&#34;&#34;
    if account_id is None:
        account_id = self.get_trade_account_id(tokens)
    if type == &#34;all&#34;:
        logger.debug(&#34;get_activities&#34;)
        r = requests.get(
            url=&#34;{}account/activities&#34;.format(self.base_url),
            params={&#34;account-id&#34;:account_id, &#34;limit&#34;:limit},
            headers=tokens[0]
        )
    else:
        logger.debug(&#34;get_activities&#34;)
        r = requests.get(
            url=&#34;{}account/activities&#34;.format(self.base_url),
            params={&#34;account-id&#34;:account_id, &#34;type&#34;:type, &#34;limit&#34;:limit},
            headers=tokens[0]
        )  
    logger.debug(f&#34;get_activities {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_activities_bookmark"><code class="name flex">
<span>def <span class="ident">get_activities_bookmark</span></span>(<span>self, tokens, bookmark=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Provides the last 20 activities on the Wealthsimple Trade based on the bookmark. <br>
Where <strong><em>bookmark</em></strong> is the bookmark id.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_activities_bookmark(self, tokens, bookmark = None):
    &#34;&#34;&#34;
    Provides the last 20 activities on the Wealthsimple Trade based on the bookmark.   
    Where ***bookmark*** is the bookmark id.   
    &#34;&#34;&#34;
    logger.debug(&#34;get_activities_bookmark&#34;)
    r = requests.get(
        url=&#34;{}account/activities&#34;.format(self.base_url),
        params={&#34;bookmark&#34;: bookmark},
        headers=tokens[0]
    )
    logger.debug(f&#34;get_activities_bookmark {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_alerts"><code class="name flex">
<span>def <span class="ident">get_alerts</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grab all global alerts</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_alerts(self, tokens):
    &#34;&#34;&#34;
    Grab all global alerts
    &#34;&#34;&#34;
    logger.debug(&#34;get_alerts&#34;)
    result = {}
    r_user = requests.get(
        url=&#39;{}global-alerts/user&#39;.format(self.base_url),
        headers=tokens[0]
    )
    r_all = requests.get(
        url=&#39;{}global-alerts&#39;.format(self.base_url),
        headers=tokens[0]
    ) 
    result[&#34;user&#34;] = r_user.json()[&#34;results&#34;]
    result[&#34;all&#34;] = r_all.json()[&#34;results&#34;]
    logger.debug(f&#34;get_alerts user:{r_user.status_code} all:{r_all.status_code}&#34;)
    if (r_user.status_code == 401 or r_all.status_code == 401) :
        raise InvalidAccessTokenError
    else:
        return result</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_all_markets"><code class="name flex">
<span>def <span class="ident">get_all_markets</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all market data including opening and closing hours</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_all_markets(self, tokens):
    &#34;&#34;&#34;
    Grabs all market data including opening and closing hours 
    &#34;&#34;&#34;
    logger.debug(&#34;get_all_markets&#34;)
    r = requests.get(
        url=&#39;{}markets&#39;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_all_markets {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_all_securities_groups"><code class="name flex">
<span>def <span class="ident">get_all_securities_groups</span></span>(<span>self, tokens, offset:int=0, limit:int=25, order:str='desc')</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all security groups under Wealthsimple trade<br>
Where <strong><em>offset</em></strong> is &gt;= 0: autoset to 0<br>
Where <strong><em>limit</em></strong> is the limitation of the response, (1 &lt;= limit &lt; 99): autoset to 25<br>
Where <strong><em>sort_order</em></strong> is order of the results and can be ["asc", "desc"]: autoset to "desc"</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_all_securities_groups(self, 
                              tokens,
                              offset: int = 0,
                              limit: int = 25,
                              order: str = &#34;desc&#34;):
    &#34;&#34;&#34;
    Grabs all security groups under Wealthsimple trade  
    Where ***offset*** is &gt;= 0: autoset to 0  
    Where ***limit*** is the limitation of the response, (1 &lt;= limit &lt; 99): autoset to 25  
    Where ***sort_order*** is order of the results and can be [&#34;asc&#34;, &#34;desc&#34;]: autoset to &#34;desc&#34;  
    &#34;&#34;&#34;
    logger.debug(&#34;get_all_securities_groups&#34;)
    r = requests.get(
        url=&#34;{}security-groups&#34;.format(self.base_url),
        params={&#34;offset&#34;:offset, &#34;limit&#34;:limit, &#34;sort_order&#34;:order},
        headers=tokens[0]
    )
    logger.debug(f&#34;get_all_securities_groups {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        print(r.status_code)
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_bank_accounts"><code class="name flex">
<span>def <span class="ident">get_bank_accounts</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all bank accounts under your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_bank_accounts(self, tokens):
    &#34;&#34;&#34;
    Grabs all bank accounts under your Wealthsimple Trade account. 
    &#34;&#34;&#34;
    logger.debug(&#34;get_bank_accounts&#34;)
    r = requests.get(
        url=&#34;{}bank-accounts&#34;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_bank_accounts {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError()
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_deposit"><code class="name flex">
<span>def <span class="ident">get_deposit</span></span>(<span>self, tokens, funds_transfer_id:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Get specific deposit under this Wealthsimple Trade account.<br>
Where <strong><em>funds_transfer_id</em></strong> is the id of the deposit</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_deposit(self, tokens, funds_transfer_id: str):
    &#34;&#34;&#34;
    Get specific deposit under this Wealthsimple Trade account.  
    Where ***funds_transfer_id*** is the id of the deposit  
    &#34;&#34;&#34;
    logger.debug(&#34;get_deposits&#34;)
    r = requests.get(
        url=&#34;{}deposits/{}&#34;.format(self.base_url, funds_transfer_id),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_deposits {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_exchange_rate"><code class="name flex">
<span>def <span class="ident">get_exchange_rate</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Current Wealthsimple Trade forex USD/CAD exchange rates.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_exchange_rate(self, tokens):
    &#34;&#34;&#34;
    Current Wealthsimple Trade forex USD/CAD exchange rates. 
    &#34;&#34;&#34;
    logger.debug(&#34;get_exchange_rate&#34;)
    r = requests.get(
        url=&#34;{}forex&#34;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_exchange_rate {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_fact_sheets"><code class="name flex">
<span>def <span class="ident">get_fact_sheets</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Get all fact-sheets that you have access to under your Wealthsimple account</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_fact_sheets(self, tokens):
    &#34;&#34;&#34;
    Get all fact-sheets that you have access to under your Wealthsimple account
    &#34;&#34;&#34;
    logger.debug(&#34;get_fact_sheets&#34;)
    r = requests.get(
        url=&#39;{}fact-sheets&#39;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_fact_sheets {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_featured_security_groups"><code class="name flex">
<span>def <span class="ident">get_featured_security_groups</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all featured security groups under Wealthsimple trade today</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_featured_security_groups(self, tokens):
    &#34;&#34;&#34;
    Grabs all featured security groups under Wealthsimple trade today
    &#34;&#34;&#34;
    logger.debug(&#34;get_featured_security_groups&#34;)
    r = requests.get(
        url=&#39;{}security-groups/featured&#39;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_featured_security_groups {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_historical_portfolio_data"><code class="name flex">
<span>def <span class="ident">get_historical_portfolio_data</span></span>(<span>self, tokens, time:str='1d', account_id:Optional[str]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs historical portfolio information for your Wealthsimple Trade account for a specified timeframe.<br>
Where <strong><em>time</em></strong> is one of [1d, 1w, 1m, 3m, 1y, all]: autoset to 1d.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_historical_portfolio_data(self,
                                  tokens,
                                  time: str = &#34;1d&#34;,
                                  account_id: Optional[str] = None
                                  ):
    &#34;&#34;&#34;
    Grabs historical portfolio information for your Wealthsimple Trade account for a specified timeframe.  
    Where ***time*** is one of [1d, 1w, 1m, 3m, 1y, all]: autoset to 1d.  
    &#34;&#34;&#34;
    logger.debug(&#34;get_historical_portfolio_data call&#34;)
    if account_id == None:
        account_id = self.get_trade_account_id(tokens)
    r = requests.get(
        url=&#34;{}account/history/{}&#34;.format(self.base_url, time),
        params={&#34;account_id&#34;:account_id},
        headers=tokens[0]
    )
    logger.debug(f&#34;get_historical_portfolio_data {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_market_hours"><code class="name flex">
<span>def <span class="ident">get_market_hours</span></span>(<span>self, tokens, exchange:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Get all market data about a specific exchange.<br>
Where <strong><em>exchange</em></strong> is the exchange name.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_market_hours(self, tokens, exchange: str):
    &#34;&#34;&#34;
    Get all market data about a specific exchange.  
    Where ***exchange*** is the exchange name.
    &#34;&#34;&#34;
    try:
        logger.debug(&#34;get_market_hours&#34;)
        exchanges = list(self.exh_to_mic.keys())
        if exchange in exchanges:
            all_markets = self.get_all_markets(tokens)[&#39;results&#39;]
            for market in all_markets:
                if market[&#34;exchange_name&#34;] == exchange:
                    return market
        else:
            return {}
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_me"><code class="name flex">
<span>def <span class="ident">get_me</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs basic information about your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_me(self, tokens):
    &#34;&#34;&#34;
    Grabs basic information about your Wealthsimple Trade account.
    &#34;&#34;&#34;
    logger.debug(&#34;get_me call&#34;)
    r = requests.get(
        url=&#34;{}me&#34;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_me {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_mobile_dashboard"><code class="name flex">
<span>def <span class="ident">get_mobile_dashboard</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Get all info in the mobile dashboard</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_mobile_dashboard(self, tokens):
    &#34;&#34;&#34;
    Get all info in the mobile dashboard
    &#34;&#34;&#34;
    logger.debug(&#34;get_mobile_dashboard&#34;)
    r = requests.get(
        url=&#39;{}mobile-dashboard&#39;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_mobile_dashboard {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_monthly_statements"><code class="name flex">
<span>def <span class="ident">get_monthly_statements</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all monthly statements under your Wealthsimple account</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_monthly_statements(self, tokens):
    &#34;&#34;&#34;
    Grabs all monthly statements under your Wealthsimple account
    &#34;&#34;&#34;
    logger.debug(&#34;get_monthly_statements&#34;)
    r = requests.get(
        url=&#39;{}monthly-statements&#39;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_monthly_statements {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_monthly_statements_cleaned"><code class="name flex">
<span>def <span class="ident">get_monthly_statements_cleaned</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all monthly statements under your Wealthsimple account.<br>
Is diffrent from <strong><em>get_monthly_statements</em></strong> as it clean the response data.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_monthly_statements_cleaned(self, tokens):
    &#34;&#34;&#34;
    Grabs all monthly statements under your Wealthsimple account.  
    Is diffrent from ***get_monthly_statements*** as it clean the response data.   
    &#34;&#34;&#34;
    try:
        logger.debug(&#34;get_all_monthly_statements&#34;)
        monthly_statements_data = self.get_monthly_statements(tokens)[&#34;results&#34;]
        result = []
        for data in monthly_statements_data:
            inner_dict = {}
            inner_dict[&#34;created_at&#34;] = data[&#34;created_at&#34;]
            inner_dict[&#34;updated_at&#34;] = data[&#34;updated_at&#34;]
            inner_dict[&#34;period&#34;] = data[&#34;period&#34;]
            inner_dict[&#34;id&#34;] = data[&#34;id&#34;]
            inner_dict[&#34;url&#34;] = self.get_monthly_statements_url(tokens, data[&#34;id&#34;])[&#34;url&#34;]
            result.append(inner_dict)
        logger.debug(f&#34;get_all_monthly_statements ^^^&#34;)    
        return result
                    
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_monthly_statements_url"><code class="name flex">
<span>def <span class="ident">get_monthly_statements_url</span></span>(<span>self, tokens, pdf_statement_id)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs a url to a pdf of your statement.<br>
Where <strong><em>pdf_statement_id</em></strong> is the id of the month you want to get.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_monthly_statements_url(self, tokens, pdf_statement_id):
    &#34;&#34;&#34;
    Grabs a url to a pdf of your statement.  
    Where ***pdf_statement_id*** is the id of the month you want to get.  
    &#34;&#34;&#34;
    logger.debug(&#34;get_monthly_statements&#34;)
    r = requests.get(
        url=&#39;{}monthly-statements/{}&#39;.format(self.base_url, pdf_statement_id),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_monthly_statements {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_most_active_securities"><code class="name flex">
<span>def <span class="ident">get_most_active_securities</span></span>(<span>self, tokens, limit:int=20)</span>
</code></dt>
<dd>
<div class="desc"><p>Grab a list of most active securities under Wealthsimple trade today.<br>
Where <strong><em>limit</em></strong> is the amount of response you want from the request.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_most_active_securities(self,
                               tokens,
                               limit: int = 20):
    &#34;&#34;&#34;
    Grab a list of most active securities under Wealthsimple trade today.  
    Where ***limit*** is the amount of response you want from the request.  
    &#34;&#34;&#34;
    logger.debug(&#34;get_most_active_securities&#34;)
    r = requests.get(
        url=&#39;{}securities/top_market_movers&#39;.format(self.base_url),
        params={&#34;type&#34;:&#34;most_active&#34;,&#34;limit&#34;:limit},
        headers=tokens[0]
    )
    logger.debug(f&#34;get_most_active_securities {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()      </code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_most_watched_securities"><code class="name flex">
<span>def <span class="ident">get_most_watched_securities</span></span>(<span>self, tokens, offset:int=0, limit:int=20)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all most watched securities under Wealthsimple trade today.
Where <strong><em>offset</em></strong> is the displacement between the selected offset and the beginning. <br>
Where <strong><em>limit</em></strong> is the amount of response you want from the request.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_most_watched_securities(self,
                                tokens,
                                offset: int = 0,
                                limit: int = 20):
    &#34;&#34;&#34;
    Grabs all most watched securities under Wealthsimple trade today.
    Where ***offset*** is the displacement between the selected offset and the beginning.   
    Where ***limit*** is the amount of response you want from the request.  
    &#34;&#34;&#34;
    logger.debug(&#34;get_most_watched_securities&#34;)
    r = requests.get(
        url=&#39;{}securities/most_watched&#39;.format(self.base_url),
        params={&#34;limit&#34;:limit,&#34;offset&#34;:offset},
        headers=tokens[0]
    )
    logger.debug(f&#34;get_most_watched_securities {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()    </code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_orders"><code class="name flex">
<span>def <span class="ident">get_orders</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all current and past orders.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_orders(self, tokens):
    &#34;&#34;&#34;
    Grabs all current and past orders.
    &#34;&#34;&#34;
    logger.debug(&#34;get_orders&#34;)
    r = requests.get(
        url=&#34;{}orders&#34;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_orders {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_person"><code class="name flex">
<span>def <span class="ident">get_person</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs Advanced/information about your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_person(self, tokens):
    &#34;&#34;&#34;
    Grabs Advanced/information about your Wealthsimple Trade account. 
    &#34;&#34;&#34;
    logger.debug(&#34;get_person&#34;)
    r = requests.get(
        url=&#34;{}person&#34;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_person {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError()
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_positions"><code class="name flex">
<span>def <span class="ident">get_positions</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs your current Wealthsimple Trade positions.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_positions(self, tokens):
    &#34;&#34;&#34;
    Grabs your current Wealthsimple Trade positions.    
    &#34;&#34;&#34;
    logger.debug(&#34;get_positions&#34;)
    r = requests.get(
        url=&#34;{}account/positions&#34;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_positions {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError()
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_securities_in_groups"><code class="name flex">
<span>def <span class="ident">get_securities_in_groups</span></span>(<span>self, tokens, group_id:str, offset:int=0, limit:int=20, filter_type:str=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all securities groups under Wealthsimple trade.
Where <strong><em>filter_type</em></strong> - "most_watched" ?
Where <strong><em>offset</em></strong> is the displacement between the selected offset and the beginning. <br>
Where <strong><em>limit</em></strong> is the amount of response you want from the request.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_securities_in_groups(self, 
                             tokens,
                             group_id: str,
                             offset: int = 0,
                             limit: int = 20,
                             filter_type: str = None):
    &#34;&#34;&#34;
    Grabs all securities groups under Wealthsimple trade. 
    Where ***filter_type*** - &#34;most_watched&#34; ? 
    Where ***offset*** is the displacement between the selected offset and the beginning.   
    Where ***limit*** is the amount of response you want from the request.  
    &#34;&#34;&#34;
    logger.debug(&#34;get_securities_in_groups&#34;)
    r = requests.get(
        url=&#39;{}security-groups/{}/securities&#39;.format(self.base_url, group_id),
        params={&#34;limit&#34;:limit,&#34;offset&#34;:offset,&#34;filter_type&#34;:filter_type},
        headers=tokens[0]
    )        
    logger.debug(f&#34;get_securities_in_groups {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_supported_internal_transfers"><code class="name flex">
<span>def <span class="ident">get_supported_internal_transfers</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs a list of all support interal transfers</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_supported_internal_transfers(self, tokens):
    &#34;&#34;&#34;
    Grabs a list of all support interal transfers
    &#34;&#34;&#34;
    logger.debug(&#34;get_supported_internal_transfers&#34;)
    r = requests.get(
        url=&#39;{}supported-internal-transfers&#39;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_supported_internal_transfers {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_tax_documents"><code class="name flex">
<span>def <span class="ident">get_tax_documents</span></span>(<span>self, tokens, account_id:Optional[str]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Grab tax documents of your Wealthsimple account</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_tax_documents(self, 
                      tokens, 
                      account_id: Optional[str] = None):
    &#34;&#34;&#34;
    Grab tax documents of your Wealthsimple account
    &#34;&#34;&#34;
    logger.debug(&#34;get_tax_documents&#34;)
    if account_id is None:
        account_id = self.get_trade_account_id(tokens)
    r = requests.get(
        url=&#39;{}tax-documents&#39;.format(self.base_url),
        param={&#34;account_id&#34;, account_id},
        headers=tokens[0]
    )
    logger.debug(f&#34;get_tax_documents {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_top_gainers_securities"><code class="name flex">
<span>def <span class="ident">get_top_gainers_securities</span></span>(<span>self, tokens, offset:int=0, limit:int=20)</span>
</code></dt>
<dd>
<div class="desc"><p>Grab a list of top gainers securities under Wealthsimple trade today.
Where <strong><em>offset</em></strong> is the displacement between the selected offset and the beginning. <br>
Where <strong><em>limit</em></strong> is the amount of response you want from the request.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_top_gainers_securities(self,
                               tokens,
                               offset: int = 0,
                               limit: int = 20):
    &#34;&#34;&#34;
    Grab a list of top gainers securities under Wealthsimple trade today.
    Where ***offset*** is the displacement between the selected offset and the beginning.   
    Where ***limit*** is the amount of response you want from the request.  
    &#34;&#34;&#34;
    logger.debug(&#34;get_top_gainers_securities&#34;)
    r = requests.get(
        url=&#39;{}securities/top_market_movers&#39;.format(self.base_url),
        params={&#34;type&#34;:&#34;gainers&#34;,&#34;limit&#34;:limit,&#34;offset&#34;:offset},
        headers=tokens[0]
    )
    logger.debug(f&#34;get_top_gainers_securities {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()  </code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_top_losers_securities"><code class="name flex">
<span>def <span class="ident">get_top_losers_securities</span></span>(<span>self, tokens, offset:int=0, limit:int=20)</span>
</code></dt>
<dd>
<div class="desc"><p>Grab a list of top losers securities under Wealthsimple trade today.
Where <strong><em>offset</em></strong> is the displacement between the selected offset and the beginning. <br>
Where <strong><em>limit</em></strong> is the amount of response you want from the request.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_top_losers_securities(self,
                              tokens,
                              offset: int = 0,
                              limit: int = 20):
    &#34;&#34;&#34;
    Grab a list of top losers securities under Wealthsimple trade today.
    Where ***offset*** is the displacement between the selected offset and the beginning.   
    Where ***limit*** is the amount of response you want from the request.  
    &#34;&#34;&#34;
    logger.debug(&#34;get_top_losers_securities&#34;)
    r = requests.get(
        url=&#39;{}securities/top_market_movers&#39;.format(self.base_url),
        params={&#34;type&#34;:&#34;losers&#34;,&#34;limit&#34;:limit,&#34;offset&#34;:offset},
        headers=tokens[0]
    )
    logger.debug(f&#34;get_top_losers_securities {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json() </code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_trade_account_id"><code class="name flex">
<span>def <span class="ident">get_trade_account_id</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>If any function 'account_id' param is empty, it will use
this function to get the first trading id</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_trade_account_id(self, tokens):
    &#34;&#34;&#34; 
    If any function &#39;account_id&#39; param is empty, it will use 
    this function to get the first trading id  &#34;&#34;&#34;
    accounts = self.get_accounts(tokens)[&#34;results&#34;]
    for account in accounts:
        if account[&#34;account_type&#34;] == &#34;ca_non_registered&#34;:
            return account[&#34;id&#34;]</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_watchlist"><code class="name flex">
<span>def <span class="ident">get_watchlist</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Get all watchlisted securities under your Wealthsimple trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_watchlist(self, tokens):
    &#34;&#34;&#34;
    Get all watchlisted securities under your Wealthsimple trade account. 
    &#34;&#34;&#34;
    logger.debug(&#34;get_watchlist&#34;)
    r = requests.get(
        url=&#34;{}watchlist&#34;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_watchlist {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_websocket_ticket"><code class="name flex">
<span>def <span class="ident">get_websocket_ticket</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs a websocket ticket, need to connect to the wealthsimple websocket
url for accessing websocket is:
"wss://trade-service.wealthsimple.com/websocket?ticket={}&amp;version=2".format(ticket)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_websocket_ticket(self, tokens):
    &#34;&#34;&#34;
    Grabs a websocket ticket, need to connect to the wealthsimple websocket 
    url for accessing websocket is:
    &#34;wss://trade-service.wealthsimple.com/websocket?ticket={}&amp;version=2&#34;.format(ticket) 
    &#34;&#34;&#34;
    logger.debug(&#34;get_websocket_ticket&#34;)
    r = requests.post(
        url=&#39;{}websocket-ticket&#39;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_websocket_ticket {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()  </code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.get_withdrawal"><code class="name flex">
<span>def <span class="ident">get_withdrawal</span></span>(<span>self, tokens, funds_transfer_id:str)</span>
</code></dt>
<dd>
<div class="desc"><p>Get specific withdrawal under yout Wealthsimple Trade account.
Where <strong><em>funds_transfer_id</em></strong> is the id of the withdrawal</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_withdrawal(self, tokens, funds_transfer_id: str):
    &#34;&#34;&#34;
    Get specific withdrawal under yout Wealthsimple Trade account.
    Where ***funds_transfer_id*** is the id of the withdrawal
    &#34;&#34;&#34;
    logger.debug(&#34;get_withdrawal&#34;)
    r = requests.get(
        url=&#34;{}withdrawals/{}&#34;.format(self.base_url, funds_transfer_id),
        headers=tokens[0]
    )
    logger.debug(f&#34;get_withdrawal {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.iscanadiansecurity"><code class="name flex">
<span>def <span class="ident">iscanadiansecurity</span></span>(<span>_, x)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">iscanadiansecurity = lambda _, x: x in [&#34;TSX&#34;,&#34;TSX-V&#34;]</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.limit_buy_order"><code class="name flex">
<span>def <span class="ident">limit_buy_order</span></span>(<span>self, tokens, security_id:str, limit_price, quantity:int=1, account_id:Optional[str]=None, time_in_force:str='day')</span>
</code></dt>
<dd>
<div class="desc"><p>Places a limit buy order for a security.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def limit_buy_order(self,
                    tokens,
                    security_id: str,
                    limit_price,
                    quantity: int = 1,
                    account_id: Optional[str] = None,
                    time_in_force: str =&#34;day&#34;):
    &#34;&#34;&#34;
    Places a limit buy order for a security.    
    &#34;&#34;&#34;
    try:
        logger.debug(&#34;buy_limit_order&#34;)
        if account_id is None:
            account_id = self.get_trade_account_id(tokens)
        return self._send_order(tokens, {
            &#34;security_id&#34;: security_id,
            &#34;account_id&#34;: account_id,
            &#34;limit_price&#34;: limit_price,
            &#34;quantity&#34;: quantity,
            &#34;order_type&#34;: &#34;buy_quantity&#34;,
            &#34;order_sub_type&#34;: &#34;limit&#34;,
            &#34;time_in_force&#34;: time_in_force,
        })
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.limit_sell_order"><code class="name flex">
<span>def <span class="ident">limit_sell_order</span></span>(<span>self, tokens, security_id:str, limit_price, quantity:int=1, time_in_force:str='day', account_id:Optional[str]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Places a limit sell order for a security.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def limit_sell_order(self,
                     tokens,
                     security_id: str,
                     limit_price,
                     quantity: int = 1,
                     time_in_force: str = &#34;day&#34;,
                     account_id: Optional[str] = None
                     ):
    &#34;&#34;&#34;
    Places a limit sell order for a security.  
    &#34;&#34;&#34;
    try:
        logger.debug(&#34;sell_limit_order&#34;)
        if account_id is None:
            account_id = self.get_trade_account_id(tokens)
        return self._send_order(tokens, {
            &#34;security_id&#34;: security_id,
            &#34;limit_price&#34;: limit_price,
            &#34;quantity&#34;: quantity,
            &#34;order_type&#34;: &#34;sell_quantity&#34;,
            &#34;order_sub_type&#34;: &#34;limit&#34;,
            &#34;time_in_force&#34;: time_in_force,
            &#34;account_id&#34;: account_id
        })
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.list_deposits"><code class="name flex">
<span>def <span class="ident">list_deposits</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Get all deposits under your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def list_deposits(self, tokens):
    &#34;&#34;&#34;
    Get all deposits under your Wealthsimple Trade account.
    &#34;&#34;&#34;
    logger.debug(&#34;list_deposits&#34;)
    r = requests.get(
        url=&#34;{}deposits&#34;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;list_deposits {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.list_withdrawals"><code class="name flex">
<span>def <span class="ident">list_withdrawals</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Get all withdrawals under your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def list_withdrawals(self, tokens):
    &#34;&#34;&#34;
    Get all withdrawals under your Wealthsimple Trade account.
    &#34;&#34;&#34;
    logger.debug(&#34;list_withdrawals&#34;)
    r = requests.get(
        url=&#34;{}withdrawals&#34;.format(self.base_url),
        headers=tokens[0]
    )
    logger.debug(f&#34;list_withdrawals {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.make_deposit"><code class="name flex">
<span>def <span class="ident">make_deposit</span></span>(<span>self, tokens, amount:int, currency:str='CAD', bank_account_id:str=None, account_id:Optional[str]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Make a deposit under your Wealthsimple Trade account.
Where <strong><em>amount</em></strong> is the amount to deposit<br>
Where <strong><em>currency</em></strong> is the currency need to be transferred: autoset to "CAD"<br>
Where <strong><em>bank_account_id</em></strong> is id of bank account.<br>
Where <strong><em>account_id</em></strong> is id of the account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def make_deposit(self, 
                 tokens, 
                 amount: int,
                 currency: str = &#34;CAD&#34;, 
                 bank_account_id: str = None, 
                 account_id: Optional[str] = None):
    &#34;&#34;&#34;
    Make a deposit under your Wealthsimple Trade account. 
    Where ***amount*** is the amount to deposit  
    Where ***currency*** is the currency need to be transferred: autoset to &#34;CAD&#34;  
    Where ***bank_account_id*** is id of bank account.  
    Where ***account_id*** is id of the account.  
    &#34;&#34;&#34;
    logger.debug(&#34;make_deposits&#34;)
    if bank_account_id == None:
        bank_account_id = self.get_bank_accounts()[&#34;results&#34;][0][&#34;id&#34;]
    if account_id == None:
        account_id = self.get_trade_account_id(tokens)
    person = self.get_person()
    payload = {
        &#34;client_id&#34;: str(person[&#34;id&#34;]),
        &#34;bank_account_id&#34;: str(bank_account_id),
        &#34;account_id&#34;: str(account_id),
        &#34;amount&#34;: float(amount),
        &#34;currency&#34;: str(currency)
    }
    r = requests.post(
        url=&#39;{}deposits&#39;.format(self.base_url),
        headers=tokens[0],
        data=payload
    )
    logger.debug(f&#34;make_deposits {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.make_withdrawal"><code class="name flex">
<span>def <span class="ident">make_withdrawal</span></span>(<span>self, tokens, amount:int, currency:str='CAD', bank_account_id:str=None, account_id:Optional[str]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Make a withdrawal under your Wealthsimple Trade account.<br>
Where <strong><em>amount</em></strong> is the amount to withdraw.<br>
Where <strong><em>currency</em></strong> is the currency need to be withdrawn: autoset to "CAD"<br>
Where <strong><em>bank_account_id</em></strong> is id of bank account where the money is going to be withdrawn from (get_bank_accounts function)<br>
Where <strong><em>account_id</em></strong> is id of the account that is withdrawing the money.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def make_withdrawal(self,
                    tokens, 
                    amount: int,
                    currency: str = &#34;CAD&#34;,
                    bank_account_id: str = None,
                    account_id: Optional[str] = None):
    &#34;&#34;&#34;
    Make a withdrawal under your Wealthsimple Trade account.  
    Where ***amount*** is the amount to withdraw.  
    Where ***currency*** is the currency need to be withdrawn: autoset to &#34;CAD&#34;  
    Where ***bank_account_id*** is id of bank account where the money is going to be withdrawn from (get_bank_accounts function)  
    Where ***account_id*** is id of the account that is withdrawing the money.  
    &#34;&#34;&#34;
    logger.debug(&#34;make_withdrawal&#34;)
    if bank_account_id == None:
        bank_account_id = self.get_bank_accounts()[&#34;results&#34;][0][&#34;id&#34;]
    if account_id == None:
        account_id = self.get_trade_account_id(tokens)
    person = self.get_person()
    payload = {
        &#34;bank_account_id&#34;: str(bank_account_id),
        &#34;account_id&#34;: str(account_id),
        &#34;client_id&#34;: str(person[&#34;id&#34;]),
        &#34;withdrawal_type&#34;: &#34;full&#34;,
        &#34;withdrawal_reason&#34;: &#34;other&#34;,
        &#34;withdrawal_reason_details&#34;: &#34;other&#34;,
        &#34;amount&#34;: float(amount),
        &#34;currency&#34;: str(currency)
    }
    r = requests.post(
        url=&#39;{}withdrawals&#39;.format(self.base_url),
        headers=tokens[0],
        data=payload
    )
    logger.debug(f&#34;make_withdrawal {r.status_code}&#34;)
    if r.status_code == 401:
        raise InvalidAccessTokenError
    else:
        return r.json()</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.market_buy_order"><code class="name flex">
<span>def <span class="ident">market_buy_order</span></span>(<span>self, tokens, security_id:str, quantity:int=1, account_id:Optional[str]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Places a market buy order for a security.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def market_buy_order(self,
                     tokens,
                     security_id: str,
                     quantity: int = 1,
                     account_id: Optional[str] = None,
                     ):
    &#34;&#34;&#34;
    Places a market buy order for a security.  
    &#34;&#34;&#34;
    try:
        logger.debug(&#34;buy_market_order&#34;)
        if account_id is None:
            account_id = self.get_trade_account_id(tokens)
        return self._send_order(tokens, {
            &#34;security_id&#34;: security_id,
            &#34;limit_price&#34;: 1,
            &#34;quantity&#34;: quantity,
            &#34;order_type&#34;: &#34;buy_quantity&#34;,
            &#34;order_sub_type&#34;: &#34;market&#34;,
            &#34;time_in_force&#34;: &#34;day&#34;,
            &#34;account_id&#34;: account_id
        })
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.market_sell_order"><code class="name flex">
<span>def <span class="ident">market_sell_order</span></span>(<span>self, tokens, security_id:str, quantity:int=1, account_id:Optional[str]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Places a market sell order for a security.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def market_sell_order(self,
                      tokens,
                      security_id: str,
                      quantity: int = 1,
                      account_id: Optional[str] = None
                      ):
    &#34;&#34;&#34;
    Places a market sell order for a security.
    &#34;&#34;&#34;
    try:
        logger.debug(&#34;sell_market_order&#34;)
        if account_id is None:
            account_id = self.get_trade_account_id(tokens)
        return self._send_order(tokens, {
            &#34;security_id&#34;: security_id,
            &#34;market_value&#34;: 1,
            &#34;quantity&#34;: quantity,
            &#34;order_type&#34;: &#34;sell_quantity&#34;,
            &#34;order_sub_type&#34;: &#34;market&#34;,
            &#34;time_in_force&#34;: &#34;day&#34;,
            &#34;account_id&#34;: account_id,
        })
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.pending_orders"><code class="name flex">
<span>def <span class="ident">pending_orders</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Grabs all pending orders under your Wealthsimple Trade account.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def pending_orders(self, tokens):
    &#34;&#34;&#34;
    Grabs all pending orders under your Wealthsimple Trade account.
    &#34;&#34;&#34;
    try:
        orders = self.get_orders(tokens)[&#39;results&#39;]
        result = []
        for order in orders:
            if order[&#39;status&#39;] == &#39;submitted&#39;:
                result.append(order)
        return result
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.refresh_token"><code class="name flex">
<span>def <span class="ident">refresh_token</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Generates and applies a new set of access and refresh tokens.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def refresh_token(self, tokens):
    &#34;&#34;&#34;
    Generates and applies a new set of access and refresh tokens.  
    &#34;&#34;&#34;
    r = requests.post(
        url=&#34;{}auth/refresh&#34;.format(self.base_url),
        data=tokens[1],
    )
    if r.status_code == 401:
        self.logger.error(&#34;dead refresh token&#34;)
        raise InvalidRefreshTokenError
    else:
        self.logger.debug(f&#34;refresh token {r.status_code} code&#34;)
        self._access_token = r.headers[&#39;X-Access-Token&#39;]
        self._refresh_token = r.headers[&#39;X-Refresh-Token&#39;]
        self.tokens = [{&#39;Authorization&#39;: self._access_token}, {&#34;refresh_token&#34;: self._refresh_token}]
        return self.tokens</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.search_page"><code class="name flex">
<span>def <span class="ident">search_page</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Get groups need for search page</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def search_page(self, tokens):
    &#34;&#34;&#34;
    Get groups need for search page
    &#34;&#34;&#34;
    try:
        featured_security_groups = self.get_featured_security_groups(tokens)
        get_top_losers_securities = self.get_top_losers_securities(tokens, limit=5)
        get_top_gainers_securities = self.get_top_gainers_securities(tokens, limit=5)
        get_most_active_securities = self.get_most_active_securities(tokens, limit=5)
        get_most_watched_securities = self.get_most_watched_securities(tokens, limit=5)
        return {
            &#34;featured_security_groups&#34;: featured_security_groups,
            &#34;most_watched&#34;: get_most_watched_securities,
            &#34;most_active&#34;: get_most_active_securities,
            &#34;top_gainers&#34;: get_top_gainers_securities,
            &#34;top_losers&#34;: get_top_losers_securities,
        }
    except InvalidAccessTokenError:
        logger.error(&#34;search_page InvalidAccessTokenError&#34;)
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.settings"><code class="name flex">
<span>def <span class="ident">settings</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>Get settings data needed for settings page.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def settings(self, tokens):
    &#34;&#34;&#34;
    Get settings data needed for settings page.
    &#34;&#34;&#34;
    logger.debug(&#34;starting settings&#34;)
    try:
        me = self.get_me(tokens)
        person = self.get_person(tokens)
        bank_account = self.get_bank_accounts(tokens)
        exchange_rate = self.get_exchange_rate(tokens)
        ws_current_operational_status = self.current_status()
        return {
            &#39;me&#39;: me,
            &#39;person&#39;: person,
            &#39;bank_account&#39;: bank_account,
            &#39;exchange_rate&#39;: exchange_rate,
            &#39;ws_current_operational_status&#39;: ws_current_operational_status
        }
    except InvalidAccessTokenError:
        logger.debug(&#34;settings InvalidAccessTokenError&#34;)
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.stock"><code class="name flex">
<span>def <span class="ident">stock</span></span>(<span>self, tokens, sec_id:str, time:str='1d')</span>
</code></dt>
<dd>
<div class="desc"><p>Get security data needed for stock search pages.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stock(self,
          tokens,
          sec_id: str,
          time: str = &#34;1d&#34;):
    &#34;&#34;&#34;
    Get security data needed for stock search pages.
    &#34;&#34;&#34;
    logger.debug(&#34;starting stock {}&#34;.format(sec_id))
    try:
        sparkline = self.find_securities_by_id_historical(tokens, sec_id, time)
        security_info = self.find_securities_by_id(tokens, sec_id)
        news = self.public_find_securities_news(security_info[&#34;stock&#34;][&#34;symbol&#34;])
        position = self.get_account(tokens)
        return {
            &#34;sparkline&#34;: sparkline,
            &#34;security_info&#34;: security_info,
            &#34;position&#34;: position,
            &#34;news&#34;: news 
        }
    except InvalidAccessTokenError:
        logger.error(&#34;stock InvalidAccessTokenError&#34;)
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.stop_limit_buy_order"><code class="name flex">
<span>def <span class="ident">stop_limit_buy_order</span></span>(<span>self, tokens, security_id:str, stop_price, limit_price, quantity:int=1, time_in_force:str='day', account_id:Optional[str]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Places a stop limit buy order for a security.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop_limit_buy_order(self,
                         tokens,
                         security_id: str,
                         stop_price,
                         limit_price,
                         quantity: int = 1,
                         time_in_force: str = &#34;day&#34;,
                         account_id: Optional[str] = None
                        ):
    &#34;&#34;&#34;
    Places a stop limit buy order for a security. 
    &#34;&#34;&#34;
    try:
        if account_id is None:
            account_id = self.get_trade_account_id(tokens)
        security = self.find_securities_by_id(tokens, security_id)
        exchange = security[&#34;stock&#34;][&#34;primary_exchange&#34;]    
        if (self.iscanadiansecurity(exchange) and (stop_price != limit_price)):
            raise TSXStopLimitPriceError    
        return self._send_order(tokens, {
            &#34;security_id&#34;: security_id,
            &#34;account_id&#34;: account_id,
            &#34;stop_price&#34;: stop_price,
            &#34;limit_price&#34;: limit_price,
            &#34;quantity&#34;: quantity,
            &#34;order_type&#34;: &#34;buy_quantity&#34;,
            &#34;order_sub_type&#34;: &#34;stop_limit&#34;,
            &#34;time_in_force&#34;: time_in_force,
        })
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.stop_limit_sell_order"><code class="name flex">
<span>def <span class="ident">stop_limit_sell_order</span></span>(<span>self, tokens, security_id:str, stop_price, limit_price, quantity:int=1, time_in_force:str='day', account_id:Optional[str]=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Places a limit sell order for a security.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop_limit_sell_order(self,
                          tokens,
                          security_id: str,
                          stop_price,
                          limit_price,
                          quantity: int = 1,
                          time_in_force: str = &#34;day&#34;,
                          account_id: Optional[str] = None,
                          ):
    &#34;&#34;&#34;
    Places a limit sell order for a security.
    &#34;&#34;&#34;
    try:
        if account_id is None:
            account_id = self.get_trade_account_id(tokens)
        security = self.find_securities_by_id(tokens, security_id)
        exchange = security[&#34;stock&#34;][&#34;primary_exchange&#34;]    
        if (self.iscanadiansecurity(exchange) and (stop_price != limit_price)):
            raise TSXStopLimitPriceError   
        return self._send_order(tokens, {
            &#34;security_id&#34;: security_id,
            &#34;stop_price&#34;: stop_price,
            &#34;limit_price&#34;: limit_price,
            &#34;quantity&#34;: quantity,
            &#34;order_type&#34;: &#34;sell_quantity&#34;,
            &#34;order_sub_type&#34;: &#34;stop_limit&#34;,
            &#34;time_in_force&#34;: time_in_force,
            &#34;account_id&#34;: account_id
        })        
    except InvalidAccessTokenError:
        raise InvalidAccessTokenError</code></pre>
</details>
</dd>
<dt id="api.api.Wsimple.test_endpoint"><code class="name flex">
<span>def <span class="ident">test_endpoint</span></span>(<span>self, tokens)</span>
</code></dt>
<dd>
<div class="desc"><p>function for testing new endpoints</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_endpoint(self, tokens):
    &#34;&#34;&#34;
    function for testing new endpoints
    &#34;&#34;&#34;
    logger.debug(&#34;test endpoint&#34;)
    r = requests.post(&#34;{}test&#34;.format(self.base_url),
                headers=tokens[0]
                )
    print(f&#34;{r.status_code} {r.url}&#34;)
    print(r.headers)
    print(r.content)
    # print(r.json())
    return r.json()</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="api" href="index.html">api</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="api.api.Wsimple" href="#api.api.Wsimple">Wsimple</a></code></h4>
<ul class="">
<li><code><a title="api.api.Wsimple.activities_types" href="#api.api.Wsimple.activities_types">activities_types</a></code></li>
<li><code><a title="api.api.Wsimple.add_watchlist" href="#api.api.Wsimple.add_watchlist">add_watchlist</a></code></li>
<li><code><a title="api.api.Wsimple.bank_logos" href="#api.api.Wsimple.bank_logos">bank_logos</a></code></li>
<li><code><a title="api.api.Wsimple.base_url" href="#api.api.Wsimple.base_url">base_url</a></code></li>
<li><code><a title="api.api.Wsimple.cancel_order" href="#api.api.Wsimple.cancel_order">cancel_order</a></code></li>
<li><code><a title="api.api.Wsimple.cancel_pending_orders" href="#api.api.Wsimple.cancel_pending_orders">cancel_pending_orders</a></code></li>
<li><code><a title="api.api.Wsimple.cancelled_orders" href="#api.api.Wsimple.cancelled_orders">cancelled_orders</a></code></li>
<li><code><a title="api.api.Wsimple.create_internal_transfers" href="#api.api.Wsimple.create_internal_transfers">create_internal_transfers</a></code></li>
<li><code><a title="api.api.Wsimple.current_status" href="#api.api.Wsimple.current_status">current_status</a></code></li>
<li><code><a title="api.api.Wsimple.dashboard" href="#api.api.Wsimple.dashboard">dashboard</a></code></li>
<li><code><a title="api.api.Wsimple.delete_deposit" href="#api.api.Wsimple.delete_deposit">delete_deposit</a></code></li>
<li><code><a title="api.api.Wsimple.delete_watchlist" href="#api.api.Wsimple.delete_watchlist">delete_watchlist</a></code></li>
<li><code><a title="api.api.Wsimple.delete_withdrawal" href="#api.api.Wsimple.delete_withdrawal">delete_withdrawal</a></code></li>
<li><code><a title="api.api.Wsimple.exchanges" href="#api.api.Wsimple.exchanges">exchanges</a></code></li>
<li><code><a title="api.api.Wsimple.exh_to_mic" href="#api.api.Wsimple.exh_to_mic">exh_to_mic</a></code></li>
<li><code><a title="api.api.Wsimple.filled_orders" href="#api.api.Wsimple.filled_orders">filled_orders</a></code></li>
<li><code><a title="api.api.Wsimple.find_securities" href="#api.api.Wsimple.find_securities">find_securities</a></code></li>
<li><code><a title="api.api.Wsimple.find_securities_by_id" href="#api.api.Wsimple.find_securities_by_id">find_securities_by_id</a></code></li>
<li><code><a title="api.api.Wsimple.find_securities_by_id_historical" href="#api.api.Wsimple.find_securities_by_id_historical">find_securities_by_id_historical</a></code></li>
<li><code><a title="api.api.Wsimple.friendly_account_name" href="#api.api.Wsimple.friendly_account_name">friendly_account_name</a></code></li>
<li><code><a title="api.api.Wsimple.get_account" href="#api.api.Wsimple.get_account">get_account</a></code></li>
<li><code><a title="api.api.Wsimple.get_account_ids" href="#api.api.Wsimple.get_account_ids">get_account_ids</a></code></li>
<li><code><a title="api.api.Wsimple.get_accounts" href="#api.api.Wsimple.get_accounts">get_accounts</a></code></li>
<li><code><a title="api.api.Wsimple.get_activities" href="#api.api.Wsimple.get_activities">get_activities</a></code></li>
<li><code><a title="api.api.Wsimple.get_activities_bookmark" href="#api.api.Wsimple.get_activities_bookmark">get_activities_bookmark</a></code></li>
<li><code><a title="api.api.Wsimple.get_alerts" href="#api.api.Wsimple.get_alerts">get_alerts</a></code></li>
<li><code><a title="api.api.Wsimple.get_all_markets" href="#api.api.Wsimple.get_all_markets">get_all_markets</a></code></li>
<li><code><a title="api.api.Wsimple.get_all_securities_groups" href="#api.api.Wsimple.get_all_securities_groups">get_all_securities_groups</a></code></li>
<li><code><a title="api.api.Wsimple.get_bank_accounts" href="#api.api.Wsimple.get_bank_accounts">get_bank_accounts</a></code></li>
<li><code><a title="api.api.Wsimple.get_deposit" href="#api.api.Wsimple.get_deposit">get_deposit</a></code></li>
<li><code><a title="api.api.Wsimple.get_exchange_rate" href="#api.api.Wsimple.get_exchange_rate">get_exchange_rate</a></code></li>
<li><code><a title="api.api.Wsimple.get_fact_sheets" href="#api.api.Wsimple.get_fact_sheets">get_fact_sheets</a></code></li>
<li><code><a title="api.api.Wsimple.get_featured_security_groups" href="#api.api.Wsimple.get_featured_security_groups">get_featured_security_groups</a></code></li>
<li><code><a title="api.api.Wsimple.get_historical_portfolio_data" href="#api.api.Wsimple.get_historical_portfolio_data">get_historical_portfolio_data</a></code></li>
<li><code><a title="api.api.Wsimple.get_market_hours" href="#api.api.Wsimple.get_market_hours">get_market_hours</a></code></li>
<li><code><a title="api.api.Wsimple.get_me" href="#api.api.Wsimple.get_me">get_me</a></code></li>
<li><code><a title="api.api.Wsimple.get_mobile_dashboard" href="#api.api.Wsimple.get_mobile_dashboard">get_mobile_dashboard</a></code></li>
<li><code><a title="api.api.Wsimple.get_monthly_statements" href="#api.api.Wsimple.get_monthly_statements">get_monthly_statements</a></code></li>
<li><code><a title="api.api.Wsimple.get_monthly_statements_cleaned" href="#api.api.Wsimple.get_monthly_statements_cleaned">get_monthly_statements_cleaned</a></code></li>
<li><code><a title="api.api.Wsimple.get_monthly_statements_url" href="#api.api.Wsimple.get_monthly_statements_url">get_monthly_statements_url</a></code></li>
<li><code><a title="api.api.Wsimple.get_most_active_securities" href="#api.api.Wsimple.get_most_active_securities">get_most_active_securities</a></code></li>
<li><code><a title="api.api.Wsimple.get_most_watched_securities" href="#api.api.Wsimple.get_most_watched_securities">get_most_watched_securities</a></code></li>
<li><code><a title="api.api.Wsimple.get_orders" href="#api.api.Wsimple.get_orders">get_orders</a></code></li>
<li><code><a title="api.api.Wsimple.get_person" href="#api.api.Wsimple.get_person">get_person</a></code></li>
<li><code><a title="api.api.Wsimple.get_positions" href="#api.api.Wsimple.get_positions">get_positions</a></code></li>
<li><code><a title="api.api.Wsimple.get_securities_in_groups" href="#api.api.Wsimple.get_securities_in_groups">get_securities_in_groups</a></code></li>
<li><code><a title="api.api.Wsimple.get_supported_internal_transfers" href="#api.api.Wsimple.get_supported_internal_transfers">get_supported_internal_transfers</a></code></li>
<li><code><a title="api.api.Wsimple.get_tax_documents" href="#api.api.Wsimple.get_tax_documents">get_tax_documents</a></code></li>
<li><code><a title="api.api.Wsimple.get_top_gainers_securities" href="#api.api.Wsimple.get_top_gainers_securities">get_top_gainers_securities</a></code></li>
<li><code><a title="api.api.Wsimple.get_top_losers_securities" href="#api.api.Wsimple.get_top_losers_securities">get_top_losers_securities</a></code></li>
<li><code><a title="api.api.Wsimple.get_trade_account_id" href="#api.api.Wsimple.get_trade_account_id">get_trade_account_id</a></code></li>
<li><code><a title="api.api.Wsimple.get_watchlist" href="#api.api.Wsimple.get_watchlist">get_watchlist</a></code></li>
<li><code><a title="api.api.Wsimple.get_websocket_ticket" href="#api.api.Wsimple.get_websocket_ticket">get_websocket_ticket</a></code></li>
<li><code><a title="api.api.Wsimple.get_withdrawal" href="#api.api.Wsimple.get_withdrawal">get_withdrawal</a></code></li>
<li><code><a title="api.api.Wsimple.historical_status" href="#api.api.Wsimple.historical_status">historical_status</a></code></li>
<li><code><a title="api.api.Wsimple.iscanadiansecurity" href="#api.api.Wsimple.iscanadiansecurity">iscanadiansecurity</a></code></li>
<li><code><a title="api.api.Wsimple.limit_buy_order" href="#api.api.Wsimple.limit_buy_order">limit_buy_order</a></code></li>
<li><code><a title="api.api.Wsimple.limit_sell_order" href="#api.api.Wsimple.limit_sell_order">limit_sell_order</a></code></li>
<li><code><a title="api.api.Wsimple.list_deposits" href="#api.api.Wsimple.list_deposits">list_deposits</a></code></li>
<li><code><a title="api.api.Wsimple.list_withdrawals" href="#api.api.Wsimple.list_withdrawals">list_withdrawals</a></code></li>
<li><code><a title="api.api.Wsimple.make_deposit" href="#api.api.Wsimple.make_deposit">make_deposit</a></code></li>
<li><code><a title="api.api.Wsimple.make_withdrawal" href="#api.api.Wsimple.make_withdrawal">make_withdrawal</a></code></li>
<li><code><a title="api.api.Wsimple.market_buy_order" href="#api.api.Wsimple.market_buy_order">market_buy_order</a></code></li>
<li><code><a title="api.api.Wsimple.market_sell_order" href="#api.api.Wsimple.market_sell_order">market_sell_order</a></code></li>
<li><code><a title="api.api.Wsimple.oauth_login" href="#api.api.Wsimple.oauth_login">oauth_login</a></code></li>
<li><code><a title="api.api.Wsimple.otp_login" href="#api.api.Wsimple.otp_login">otp_login</a></code></li>
<li><code><a title="api.api.Wsimple.pending_orders" href="#api.api.Wsimple.pending_orders">pending_orders</a></code></li>
<li><code><a title="api.api.Wsimple.public" href="#api.api.Wsimple.public">public</a></code></li>
<li><code><a title="api.api.Wsimple.public_find_securities_by_ticker" href="#api.api.Wsimple.public_find_securities_by_ticker">public_find_securities_by_ticker</a></code></li>
<li><code><a title="api.api.Wsimple.public_find_securities_by_ticker_historical" href="#api.api.Wsimple.public_find_securities_by_ticker_historical">public_find_securities_by_ticker_historical</a></code></li>
<li><code><a title="api.api.Wsimple.public_find_securities_news" href="#api.api.Wsimple.public_find_securities_news">public_find_securities_news</a></code></li>
<li><code><a title="api.api.Wsimple.public_top_traded" href="#api.api.Wsimple.public_top_traded">public_top_traded</a></code></li>
<li><code><a title="api.api.Wsimple.refresh_token" href="#api.api.Wsimple.refresh_token">refresh_token</a></code></li>
<li><code><a title="api.api.Wsimple.search_page" href="#api.api.Wsimple.search_page">search_page</a></code></li>
<li><code><a title="api.api.Wsimple.settings" href="#api.api.Wsimple.settings">settings</a></code></li>
<li><code><a title="api.api.Wsimple.stock" href="#api.api.Wsimple.stock">stock</a></code></li>
<li><code><a title="api.api.Wsimple.stop_limit_buy_order" href="#api.api.Wsimple.stop_limit_buy_order">stop_limit_buy_order</a></code></li>
<li><code><a title="api.api.Wsimple.stop_limit_sell_order" href="#api.api.Wsimple.stop_limit_sell_order">stop_limit_sell_order</a></code></li>
<li><code><a title="api.api.Wsimple.summary_status" href="#api.api.Wsimple.summary_status">summary_status</a></code></li>
<li><code><a title="api.api.Wsimple.test_endpoint" href="#api.api.Wsimple.test_endpoint">test_endpoint</a></code></li>
<li><code><a title="api.api.Wsimple.time_ranges" href="#api.api.Wsimple.time_ranges">time_ranges</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>